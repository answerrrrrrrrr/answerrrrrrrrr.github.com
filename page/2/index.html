<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Answerrrrrrrrr" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="なぜベストを尽くしたのか">
<meta property="og:type" content="website">
<meta property="og:title" content="Answerrrrrrrrr">
<meta property="og:url" content="http://answerrrrrrrrr.github.io/page/2/index.html">
<meta property="og:site_name" content="Answerrrrrrrrr">
<meta property="og:description" content="なぜベストを尽くしたのか">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Answerrrrrrrrr">
<meta name="twitter:description" content="なぜベストを尽くしたのか">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Answerrrrrrrrr </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Answerrrrrrrrr</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/25/python-cookbook-translator/" itemprop="url">
                  Python-Cookbook-1.09 简化 translate 方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-05-25T21:46:44+08:00" content="2016-05-25">
              2016-05-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/25/python-cookbook-translator/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/25/python-cookbook-translator/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="string-maketrans"><a href="#string-maketrans" class="headerlink" title="string.maketrans"></a>string.maketrans</h1><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">Help</span> <span class="keyword">on</span> built-<span class="keyword">in</span> <span class="keyword">function</span> maketrans <span class="keyword">in</span> <span class="keyword">module</span> strop:</div><div class="line"></div><div class="line">maketrans(...)</div><div class="line">    maketrans(frm, <span class="keyword">to</span>) -&gt; <span class="keyword">string</span></div><div class="line"></div><div class="line">    <span class="keyword">Return</span> a <span class="keyword">translation</span> <span class="keyword">table</span> (a <span class="keyword">string</span> <span class="keyword">of</span> <span class="number">256</span> <span class="keyword">bytes</span> <span class="keyword">long</span>)</div><div class="line">    suitable <span class="keyword">for</span> <span class="keyword">use</span> <span class="keyword">in</span> string.translate.  The strings frm <span class="keyword">and</span> <span class="keyword">to</span></div><div class="line">    must be <span class="keyword">of</span> the same length.</div><div class="line">(<span class="keyword">END</span>)</div></pre></td></tr></table></figure>
<p>生成一个供<code>string.translate</code>使用的 ASCII 表，其中<code>frm</code>中的所有字符都依序被替换成<code>to</code>中字符：</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><div class="line">&gt;&gt;&gt; maketrans('abc', 'fed')</div><div class="line">'<span class="tag">\<span class="name">x</span></span>00<span class="tag">\<span class="name">x</span></span>01<span class="tag">\<span class="name">x</span></span>02<span class="tag">\<span class="name">x</span></span>03<span class="tag">\<span class="name">x</span></span>04<span class="tag">\<span class="name">x</span></span>05<span class="tag">\<span class="name">x</span></span>06<span class="tag">\<span class="name">x</span></span>07<span class="tag">\<span class="name">x</span></span>08<span class="tag">\<span class="name">t</span></span><span class="tag">\<span class="name">n</span></span><span class="tag">\<span class="name">x</span></span>0b<span class="tag">\<span class="name">x</span></span>0c<span class="tag">\<span class="name">r</span></span><span class="tag">\<span class="name">x</span></span>0e<span class="tag">\<span class="name">x</span></span>0f<span class="tag">\<span class="name">x</span></span>10<span class="tag">\<span class="name">x</span></span>11<span class="tag">\<span class="name">x</span></span>12<span class="tag">\<span class="name">x</span></span>13<span class="tag">\<span class="name">x</span></span>14<span class="tag">\<span class="name">x</span></span>15<span class="tag">\<span class="name">x</span></span>16<span class="tag">\<span class="name">x</span></span>17<span class="tag">\<span class="name">x</span></span>18<span class="tag">\<span class="name">x</span></span>19<span class="tag">\<span class="name">x</span></span>1a<span class="tag">\<span class="name">x</span></span>1b<span class="tag">\<span class="name">x</span></span>1c<span class="tag">\<span class="name">x</span></span>1d<span class="tag">\<span class="name">x</span></span>1e<span class="tag">\<span class="name">x</span></span>1f !"#<span class="formula">$%&amp;<span class="tag">\<span class="name">'</span></span>()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[<span class="tag">\<span class="name">\</span></span>]^_`feddefghijklmnopqrstuvwxyz&#123;|&#125;~<span class="tag">\<span class="name">x</span></span>7f<span class="tag">\<span class="name">x</span></span>80<span class="tag">\<span class="name">x</span></span>81<span class="tag">\<span class="name">x</span></span>82<span class="tag">\<span class="name">x</span></span>83<span class="tag">\<span class="name">x</span></span>84<span class="tag">\<span class="name">x</span></span>85<span class="tag">\<span class="name">x</span></span>86<span class="tag">\<span class="name">x</span></span>87<span class="tag">\<span class="name">x</span></span>88<span class="tag">\<span class="name">x</span></span>89<span class="tag">\<span class="name">x</span></span>8a<span class="tag">\<span class="name">x</span></span>8b<span class="tag">\<span class="name">x</span></span>8c<span class="tag">\<span class="name">x</span></span>8d<span class="tag">\<span class="name">x</span></span>8e<span class="tag">\<span class="name">x</span></span>8f<span class="tag">\<span class="name">x</span></span>90<span class="tag">\<span class="name">x</span></span>91<span class="tag">\<span class="name">x</span></span>92<span class="tag">\<span class="name">x</span></span>93<span class="tag">\<span class="name">x</span></span>94<span class="tag">\<span class="name">x</span></span>95<span class="tag">\<span class="name">x</span></span>96<span class="tag">\<span class="name">x</span></span>97<span class="tag">\<span class="name">x</span></span>98<span class="tag">\<span class="name">x</span></span>99<span class="tag">\<span class="name">x</span></span>9a<span class="tag">\<span class="name">x</span></span>9b<span class="tag">\<span class="name">x</span></span>9c<span class="tag">\<span class="name">x</span></span>9d<span class="tag">\<span class="name">x</span></span>9e<span class="tag">\<span class="name">x</span></span>9f<span class="tag">\<span class="name">xa</span></span>0<span class="tag">\<span class="name">xa</span></span>1<span class="tag">\<span class="name">xa</span></span>2<span class="tag">\<span class="name">xa</span></span>3<span class="tag">\<span class="name">xa</span></span>4<span class="tag">\<span class="name">xa</span></span>5<span class="tag">\<span class="name">xa</span></span>6<span class="tag">\<span class="name">xa</span></span>7<span class="tag">\<span class="name">xa</span></span>8<span class="tag">\<span class="name">xa</span></span>9<span class="tag">\<span class="name">xaa</span></span><span class="tag">\<span class="name">xab</span></span><span class="tag">\<span class="name">xac</span></span><span class="tag">\<span class="name">xad</span></span><span class="tag">\<span class="name">xae</span></span><span class="tag">\<span class="name">xaf</span></span><span class="tag">\<span class="name">xb</span></span>0<span class="tag">\<span class="name">xb</span></span>1<span class="tag">\<span class="name">xb</span></span>2<span class="tag">\<span class="name">xb</span></span>3<span class="tag">\<span class="name">xb</span></span>4<span class="tag">\<span class="name">xb</span></span>5<span class="tag">\<span class="name">xb</span></span>6<span class="tag">\<span class="name">xb</span></span>7<span class="tag">\<span class="name">xb</span></span>8<span class="tag">\<span class="name">xb</span></span>9<span class="tag">\<span class="name">xba</span></span><span class="tag">\<span class="name">xbb</span></span><span class="tag">\<span class="name">xbc</span></span><span class="tag">\<span class="name">xbd</span></span><span class="tag">\<span class="name">xbe</span></span><span class="tag">\<span class="name">xbf</span></span><span class="tag">\<span class="name">xc</span></span>0<span class="tag">\<span class="name">xc</span></span>1<span class="tag">\<span class="name">xc</span></span>2<span class="tag">\<span class="name">xc</span></span>3<span class="tag">\<span class="name">xc</span></span>4<span class="tag">\<span class="name">xc</span></span>5<span class="tag">\<span class="name">xc</span></span>6<span class="tag">\<span class="name">xc</span></span>7<span class="tag">\<span class="name">xc</span></span>8<span class="tag">\<span class="name">xc</span></span>9<span class="tag">\<span class="name">xca</span></span><span class="tag">\<span class="name">xcb</span></span><span class="tag">\<span class="name">xcc</span></span><span class="tag">\<span class="name">xcd</span></span><span class="tag">\<span class="name">xce</span></span><span class="tag">\<span class="name">xcf</span></span><span class="tag">\<span class="name">xd</span></span>0<span class="tag">\<span class="name">xd</span></span>1<span class="tag">\<span class="name">xd</span></span>2<span class="tag">\<span class="name">xd</span></span>3<span class="tag">\<span class="name">xd</span></span>4<span class="tag">\<span class="name">xd</span></span>5<span class="tag">\<span class="name">xd</span></span>6<span class="tag">\<span class="name">xd</span></span>7<span class="tag">\<span class="name">xd</span></span>8<span class="tag">\<span class="name">xd</span></span>9<span class="tag">\<span class="name">xda</span></span><span class="tag">\<span class="name">xdb</span></span><span class="tag">\<span class="name">xdc</span></span><span class="tag">\<span class="name">xdd</span></span><span class="tag">\<span class="name">xde</span></span><span class="tag">\<span class="name">xdf</span></span><span class="tag">\<span class="name">xe</span></span>0<span class="tag">\<span class="name">xe</span></span>1<span class="tag">\<span class="name">xe</span></span>2<span class="tag">\<span class="name">xe</span></span>3<span class="tag">\<span class="name">xe</span></span>4<span class="tag">\<span class="name">xe</span></span>5<span class="tag">\<span class="name">xe</span></span>6<span class="tag">\<span class="name">xe</span></span>7<span class="tag">\<span class="name">xe</span></span>8<span class="tag">\<span class="name">xe</span></span>9<span class="tag">\<span class="name">xea</span></span><span class="tag">\<span class="name">xeb</span></span><span class="tag">\<span class="name">xec</span></span><span class="tag">\<span class="name">xed</span></span><span class="tag">\<span class="name">xee</span></span><span class="tag">\<span class="name">xef</span></span><span class="tag">\<span class="name">xf</span></span>0<span class="tag">\<span class="name">xf</span></span>1<span class="tag">\<span class="name">xf</span></span>2<span class="tag">\<span class="name">xf</span></span>3<span class="tag">\<span class="name">xf</span></span>4<span class="tag">\<span class="name">xf</span></span>5<span class="tag">\<span class="name">xf</span></span>6<span class="tag">\<span class="name">xf</span></span>7<span class="tag">\<span class="name">xf</span></span>8<span class="tag">\<span class="name">xf</span></span>9<span class="tag">\<span class="name">xfa</span></span><span class="tag">\<span class="name">xfb</span></span><span class="tag">\<span class="name">xfc</span></span><span class="tag">\<span class="name">xfd</span></span><span class="tag">\<span class="name">xfe</span></span><span class="tag">\<span class="name">xff</span></span>'</span></div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure>
<h1 id="string-translate"><a href="#string-translate" class="headerlink" title="string.translate"></a>string.translate</h1><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">Help</span> <span class="keyword">on</span> <span class="keyword">function</span> <span class="keyword">translate</span> <span class="keyword">in</span> <span class="keyword">module</span> <span class="keyword">string</span>:</div><div class="line"></div><div class="line"><span class="keyword">translate</span>(s, <span class="keyword">table</span>, deletions=<span class="string">''</span>)</div><div class="line">    <span class="keyword">translate</span>(s,<span class="keyword">table</span> [,deletions]) -&gt; <span class="keyword">string</span></div><div class="line"></div><div class="line">    <span class="keyword">Return</span> a copy <span class="keyword">of</span> the <span class="keyword">string</span> s, <span class="keyword">where</span> all <span class="keyword">characters</span> occurring</div><div class="line">    <span class="keyword">in</span> the optional argument deletions <span class="keyword">are</span> removed, <span class="keyword">and</span> the</div><div class="line">    remaining <span class="keyword">characters</span> have been mapped <span class="keyword">through</span> the given</div><div class="line">    <span class="keyword">translation</span> <span class="keyword">table</span>, which must be a <span class="keyword">string</span> <span class="keyword">of</span> <span class="keyword">length</span> <span class="number">256.</span>  The</div><div class="line">    deletions argument <span class="keyword">is</span> <span class="keyword">not</span> allowed <span class="keyword">for</span> <span class="keyword">Unicode</span> strings.</div><div class="line">(<span class="keyword">END</span>)</div></pre></td></tr></table></figure>
<p>(也可以<code>s.translate(table, deletions=&#39;&#39;)</code>为格式）</p>
<p>以<code>maketrans</code>生成的映射表为基准进行字符转换：</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; translate(<span class="string">'abcdef'</span>, a)</div><div class="line"><span class="string">'feddef'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; translate(<span class="string">'abcdef'</span>, a, <span class="string">'d'</span>)</div><div class="line"><span class="string">'fedef'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; translate(<span class="string">'abcdef'</span>, a, <span class="string">'dd'</span>)</div><div class="line"><span class="string">'fedef'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; translate(<span class="string">'abcdef'</span>, a, <span class="string">'de'</span>)</div><div class="line"><span class="string">'fedf'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; translate(<span class="string">'abcdef'</span>, a, <span class="string">'ade'</span>)</div><div class="line"><span class="string">'edf'</span></div><div class="line"><span class="meta">&gt;&gt;</span>&gt;</div></pre></td></tr></table></figure>
<h1 id="自建一个返回闭包的工厂函数-translator"><a href="#自建一个返回闭包的工厂函数-translator" class="headerlink" title="自建一个返回闭包的工厂函数 translator"></a>自建一个返回闭包的工厂函数 translator</h1><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> string</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">translator</span><span class="params">(frm=<span class="string">''</span>, to=<span class="string">''</span>, delete=<span class="string">''</span>, keep=None)</span>:</span></div><div class="line">    <span class="keyword">if</span> len(to) == <span class="number">1</span>:</div><div class="line">        to = to * len(frm)</div><div class="line">    trans = string.maketrans(frm, to)</div><div class="line">    <span class="keyword">if</span> keep <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">        allchars = string.maketrans(<span class="string">''</span>, <span class="string">''</span>)</div><div class="line">        delete = allchars.translate(allchars, keep.translate(allchars, delete))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">translate</span><span class="params">(s)</span>:</span></div><div class="line">        <span class="keyword">return</span> s.translate(trans, delete)</div><div class="line">        </div><div class="line">    <span class="keyword">return</span> translate</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    digits_only = translator(keep=string.digits)</div><div class="line">    <span class="keyword">print</span> digits_only(<span class="string">'qwedwefaf24215'</span>)</div><div class="line"></div><div class="line">    no_digits = translator(delete=string.digits)</div><div class="line">    <span class="keyword">print</span> no_digits(<span class="string">'qwedwefaf24215'</span>)</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/19/Python-sorted函数中key的用法/" itemprop="url">
                  Python-sorted函数中key的用法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-05-19T09:02:08+08:00" content="2016-05-19">
              2016-05-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/19/Python-sorted函数中key的用法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/19/Python-sorted函数中key的用法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>sorted函数的可用参数如下</p>
<blockquote>
<p>sorted(iterable[, cmp[, key[, reverse]]])</p>
</blockquote>
<p>其它几个还好理解，就是<code>key</code>的用法经常会忘记，所以记录一下备用</p>
<p><a href="http://devdocs.io/python~2.7/library/functions#sorted" target="_blank" rel="external">文档</a>中说：</p>
<blockquote>
<p>key specifies a function of one argument that is used to extract a comparison key from each list element: key=str.lower. The default value is None (compare the elements directly).</p>
</blockquote>
<p>我的理解是<br><code>key</code>提供了一个函数，以<code>iterable</code>对象中的元素为唯一参数，返回一个与原元素一一对应的 key 值<br>然后再对以这些 key 值为元素的<code>iterable</code>进行排序<br>最后将这些 key 值替换回对应的原元素<br>排序完成</p>
<p>需要注意的就是<code>False &lt; True</code></p>
<p>然后是实例（参考<a href="https://segmentfault.com/q/1010000005111826/a-1020000005112829）" target="_blank" rel="external">https://segmentfault.com/q/1010000005111826/a-1020000005112829）</a></p>
<figure class="highlight py"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">s = <span class="string">'aB23'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sorted_with_key</span><span class="params">(s, key)</span>:</span></div><div class="line">    s = sorted(s, key=key)</div><div class="line">    <span class="keyword">print</span> s</div><div class="line">    <span class="keyword">print</span> <span class="string">'keys: '</span>,</div><div class="line">    <span class="keyword">print</span> [key(x) <span class="keyword">for</span> x <span class="keyword">in</span> s]</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'\nstr.lower'</span></div><div class="line">sorted_with_key(s, str.lower)</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'\nstr.islower'</span></div><div class="line">sorted_with_key(s, str.islower)</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'\nlambda x: x.isdigit() and int(x) % 2 == 0'</span></div><div class="line">sorted_with_key(s, <span class="keyword">lambda</span> x: x.isdigit() <span class="keyword">and</span> int(x) % <span class="number">2</span> == <span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'\nlambda x: x.isdigit(), x.isdigit() and int(x) % 2==0, x.isupper(), x.islower(), x'</span></div><div class="line"><span class="comment"># 排序:小写-大写-奇数-偶数</span></div><div class="line">sorted_with_key(s, <span class="keyword">lambda</span> x: (x.isdigit(), x.isdigit() <span class="keyword">and</span> int(x) %</div><div class="line">                              <span class="number">2</span> == <span class="number">0</span>, x.isupper(), x.islower(), x))</div></pre></td></tr></table></figure>
<p>output</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"></div><div class="line">str.lower</div><div class="line">[<span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'a'</span>, <span class="string">'B'</span>]</div><div class="line">keys:  [<span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>]</div><div class="line"></div><div class="line">str.islower</div><div class="line">[<span class="string">'B'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'a'</span>]</div><div class="line">keys:  [<span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>]</div><div class="line"></div><div class="line"><span class="keyword">lambda</span> x: x.isdigit() <span class="keyword">and</span> int(x) % <span class="number">2</span> == <span class="number">0</span></div><div class="line">[<span class="string">'a'</span>, <span class="string">'B'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>]</div><div class="line">keys:  [<span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>]</div><div class="line"></div><div class="line"><span class="keyword">lambda</span> x: (x.isdigit(), x.isdigit() <span class="keyword">and</span> int(x) % <span class="number">2</span>==<span class="number">0</span>, x.isupper(), x.islower(), x)</div><div class="line">[<span class="string">'a'</span>, <span class="string">'B'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>]</div><div class="line">keys:  [(<span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="string">'a'</span>), (<span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="string">'B'</span>), (<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="string">'3'</span>), (<span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="string">'2'</span>)]</div></pre></td></tr></table></figure>
<h1 id="2016-7-9-补充"><a href="#2016-7-9-补充" class="headerlink" title="2016.7.9 补充"></a>2016.7.9 补充</h1><p>今天看了 cookbook 5.2，Python 2.4 之前是不支持<code>key</code>的，书中提供了一个类似的思路，感觉对理解<code>key</code>的实现很有帮助，摘录如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">case_insensitive_sorted</span><span class="params">(string_list)</span>:</span></div><div class="line">    auxiliary_list = [(x.lower(), x) <span class="keyword">for</span> x <span class="keyword">in</span> string_list] <span class="comment"># decorate</span></div><div class="line">    auxiliary_list.sort()                                  <span class="comment"># sort</span></div><div class="line">    <span class="keyword">return</span> [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> auxiliary_list]                  <span class="comment"># undecorate</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/16/Flask-数据库更新问题/" itemprop="url">
                  Flask 数据库更新问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-05-16T21:52:45+08:00" content="2016-05-16">
              2016-05-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Flask/" itemprop="url" rel="index">
                    <span itemprop="name">Flask</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/16/Flask-数据库更新问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/16/Flask-数据库更新问题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="更新列"><a href="#更新列" class="headerlink" title="更新列"></a>更新列</h1><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>学习到 8.4.6 测试登录时</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">(venv) $ python manage<span class="selector-class">.py</span> shell </div><div class="line">&gt;&gt;&gt; u = User(email=<span class="string">'john@example.com'</span>, username=<span class="string">'john'</span>, password=<span class="string">'cat'</span>) </div><div class="line">&gt;&gt;&gt; db<span class="selector-class">.session</span><span class="selector-class">.add</span>(u) </div><div class="line">&gt;&gt;&gt; db<span class="selector-class">.session</span><span class="selector-class">.commit</span>()</div></pre></td></tr></table></figure>
<p>报错说表中无 email 列</p>
<p>确认代码无误后，判断应该是没有成功更新 models.py 中新建的 email 列，简单尝试无果，决定重新看一遍相关内容加深理解，再着手解决</p>
<h2 id="粗暴的更新方法"><a href="#粗暴的更新方法" class="headerlink" title="粗暴的更新方法"></a>粗暴的更新方法</h2><p>如果数据库表已经存在于数据库中， 那么 db.create_all() 不会重新创建或者更新这个表。如果修改模型后要把改动应用到现有的数据库中，这一特 性会带来不便。更新现有数据库表的粗暴方式是先删除旧表再重新创建：</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;</span>&gt; db.drop_all() </div><div class="line"><span class="meta">&gt;&gt;</span>&gt; db.create_all()</div></pre></td></tr></table></figure>
<h2 id="使用-Flask-Migrate-实现数据库迁移"><a href="#使用-Flask-Migrate-实现数据库迁移" class="headerlink" title="使用 Flask-Migrate 实现数据库迁移"></a>使用 Flask-Migrate 实现数据库迁移</h2><blockquote>
<p>更新表的更好方法是使用数据库迁移框架。源码版本控制工具可以跟踪源码文件的变化， 类似地，数据库迁移框架能跟踪数据库模式的变化，然后增量式的把变化应用到数据库中。</p>
<p>SQLAlchemy 的主力开发人员编写了一个迁移框架，称为 Alembic（<a href="https://alembic.readthedocs" target="_blank" rel="external">https://alembic.readthedocs</a>. org/en/latest/index.html） 。 除 了 直 接 使 用 Alembic 之 外， Flask 程 序 还 可 使 用 Flask-Migrate （<a href="http://flask-migrate.readthedocs.org/en/latest/）扩展。这个扩展对" target="_blank" rel="external">http://flask-migrate.readthedocs.org/en/latest/）扩展。这个扩展对</a> Alembic 做了轻量级包装，并 集成到 Flask-Script 中，所有操作都通过 Flask-Script 命令完成。</p>
</blockquote>
<p>安装与配置略过不提<br>几次尝试后，方才对几个主要命令的实际作用有了正确的理解</p>
<h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><p>创建迁移仓库和脚本，并不会生成或更新数据库文件，<code>migrations/versions/</code>中为空，如果此时<code>upgrade</code>会生成一个只包含<code>alembic_version</code>表的数据库</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><div class="line"><span class="symbol">$</span> sqlite3 data-dev.sqlite</div><div class="line">SQLite version <span class="number">3.8</span><span class="number">.10</span><span class="number">.2</span> <span class="number">2015</span><span class="number">-05</span><span class="number">-20</span> <span class="number">18</span>:<span class="number">17</span>:<span class="number">19</span></div><div class="line">Enter <span class="string">".help"</span> <span class="keyword">for</span> usage hints.</div><div class="line">sqlite&gt; .dump</div><div class="line">PRAGMA foreign_keys=OFF;</div><div class="line">BEGIN TRANSACTION;</div><div class="line">CREATE <span class="keyword">TABLE</span> alembic_version <span class="comment">(</span></div><div class="line">	version_num VARCHAR(<span class="number">32</span>) NOT NULL</div><div class="line">);</div><div class="line">COMMIT;</div><div class="line">sqlite&gt;</div></pre></td></tr></table></figure>
<h3 id="migrate"><a href="#migrate" class="headerlink" title="migrate"></a>migrate</h3><p>检测对数据库的操作，生成迁移脚本保存到<code>migrations/versions/</code>中，用于数据库迁移</p>
<p>不过按<a href="http://flask-migrate.readthedocs.io/en/latest/" target="_blank" rel="external">官方文档</a>所说，不一定能检测到所有对数据库的修改，所有需要自己对生成的迁移脚本进行检查，加上可能有遗漏的地方</p>
<h3 id="upgrade"><a href="#upgrade" class="headerlink" title="upgrade"></a>upgrade</h3><p>用于把上述迁移运用到数据库中，即至此才会真正对数据库进行更新</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><div class="line">$ sqlite3 data-dev.sqlite</div><div class="line">SQLite version 3.8.10.2 2015-05-20 18:17:19</div><div class="line">Enter ".help" for usage hints.</div><div class="line">sqlite&gt; .dump</div><div class="line">PRAGMA foreign_keys=OFF;</div><div class="line">BEGIN TRANSACTION;</div><div class="line"><span class="keyword">CREATE</span> TABLE alembic_version (</div><div class="line">	version_num VARCHAR(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></div><div class="line">);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"alembic_version"</span> <span class="keyword">VALUES</span>(<span class="string">'bb488872a057'</span>);</div><div class="line"><span class="keyword">CREATE</span> TABLE roles (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	name VARCHAR(<span class="number">64</span>),</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	<span class="keyword">UNIQUE</span> (name)</div><div class="line">);</div><div class="line"><span class="keyword">CREATE</span> TABLE users (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	email VARCHAR(<span class="number">64</span>),</div><div class="line">	username VARCHAR(<span class="number">64</span>),</div><div class="line">	role_id INTEGER,</div><div class="line">	password_hash VARCHAR(<span class="number">128</span>),</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	FOREIGN <span class="keyword">KEY</span>(role_id) REFERENCES roles (id)</div><div class="line">);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_email <span class="keyword">ON</span> users (email);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_username <span class="keyword">ON</span> users (username);</div><div class="line">COMMIT;</div><div class="line">sqlite&gt;</div></pre></td></tr></table></figure>
<h1 id="管理员角色"><a href="#管理员角色" class="headerlink" title="管理员角色"></a>管理员角色</h1><h2 id="遇到的问题-1"><a href="#遇到的问题-1" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>学习到 10.3.2后，发现以管理员邮箱注册的帐号并不能打开<code>管理员级别的资料编辑器</code><br>手动查看数据库：<br><figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"users"</span> <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">'huamingrui@163.com'</span>,<span class="string">'huamingrui'</span>,<span class="literal">NULL</span>,<span class="string">'pbkdf2:sha1:1000$wpqGMEz8$a3bf86fcb0be120a7510a8f702077eb2fdfa1980'</span>,<span class="number">1</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="string">'2016-05-17 14:17:48.930851'</span>,<span class="string">'2016-05-17 14:19:00.735339'</span>);</div></pre></td></tr></table></figure></p>
<p>发现<code>role_id</code>项为空，即角色没有被成功赋予</p>
<h2 id="Role-insert-roles"><a href="#Role-insert-roles" class="headerlink" title="Role.insert_roles()"></a>Role.insert_roles()</h2><p>回去翻书，找到 9.3 最后的部分说到</p>
<blockquote>
<p>在你阅读下一章之前，最好重新创建或者更新开发数据库，如此一来，那些在实现角色和 权限之前创建的用户账户就被赋予了角色。</p>
</blockquote>
<p>然而实测发现，对于管理员用户，必须在注册之前就完成 9.1 最后的<code>Role.insert_roles()</code>步骤，才能成功为管理员邮箱用户赋予<code>管理员角色</code></p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><div class="line">$ rm data-dev.sqlite</div><div class="line">$ python manage.py db upgrade</div><div class="line">INFO  [alembic.runtime.migration] Context impl SQLiteImpl.</div><div class="line">INFO  [alembic.runtime.migration] Will assume non-transactional DDL.</div><div class="line">INFO  [alembic.runtime.migration] Running upgrade  -&gt; 02ccb3e6a553, empty message</div><div class="line">$ sqlite3 data-dev.sqlite</div><div class="line">SQLite version 3.8.10.2 2015-05-20 18:17:19</div><div class="line">Enter ".help" for usage hints.</div><div class="line">sqlite&gt; .dump</div><div class="line">PRAGMA foreign_keys=OFF;</div><div class="line">BEGIN TRANSACTION;</div><div class="line"><span class="keyword">CREATE</span> TABLE alembic_version (</div><div class="line">	version_num VARCHAR(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></div><div class="line">);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"alembic_version"</span> <span class="keyword">VALUES</span>(<span class="string">'02ccb3e6a553'</span>);</div><div class="line"><span class="keyword">CREATE</span> TABLE roles (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	name VARCHAR(<span class="number">64</span>),</div><div class="line">	<span class="string">"default"</span> <span class="keyword">BOOLEAN</span>,</div><div class="line">	permissions INTEGER,</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	<span class="keyword">UNIQUE</span> (name),</div><div class="line">	CHECK (<span class="string">"default"</span> <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</div><div class="line">);</div><div class="line"><span class="keyword">CREATE</span> TABLE users (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	email VARCHAR(<span class="number">64</span>),</div><div class="line">	username VARCHAR(<span class="number">64</span>),</div><div class="line">	role_id INTEGER,</div><div class="line">	password_hash VARCHAR(<span class="number">128</span>),</div><div class="line">	confirmed <span class="keyword">BOOLEAN</span>,</div><div class="line">	name VARCHAR(<span class="number">64</span>),</div><div class="line">	location VARCHAR(<span class="number">64</span>),</div><div class="line">	about_me TEXT,</div><div class="line">	member_since DATETIME,</div><div class="line">	last_seen DATETIME,</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	FOREIGN <span class="keyword">KEY</span>(role_id) REFERENCES roles (id),</div><div class="line">	CHECK (confirmed <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</div><div class="line">);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> ix_roles_default <span class="keyword">ON</span> roles (<span class="string">"default"</span>);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_email <span class="keyword">ON</span> users (email);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_username <span class="keyword">ON</span> users (username);</div><div class="line">COMMIT;</div><div class="line">sqlite&gt; ^D</div><div class="line">$ python manage.py shell</div><div class="line">&gt;&gt;&gt; Role.insert_roles()</div><div class="line">&gt;&gt;&gt; Role.query.all()</div><div class="line">[&lt;Role u'Moderator'&gt;, &lt;Role u'Administrator'&gt;, &lt;Role u'User'&gt;]</div><div class="line">&gt;&gt;&gt; ^D</div><div class="line">$ sqlite3 data-dev.sqlite</div><div class="line">SQLite version 3.8.10.2 2015-05-20 18:17:19</div><div class="line">Enter ".help" for usage hints.</div><div class="line">sqlite&gt; .dump</div><div class="line">PRAGMA foreign_keys=OFF;</div><div class="line">BEGIN TRANSACTION;</div><div class="line"><span class="keyword">CREATE</span> TABLE alembic_version (</div><div class="line">	version_num VARCHAR(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></div><div class="line">);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"alembic_version"</span> <span class="keyword">VALUES</span>(<span class="string">'02ccb3e6a553'</span>);</div><div class="line"><span class="keyword">CREATE</span> TABLE roles (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	name VARCHAR(<span class="number">64</span>),</div><div class="line">	<span class="string">"default"</span> <span class="keyword">BOOLEAN</span>,</div><div class="line">	permissions INTEGER,</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	<span class="keyword">UNIQUE</span> (name),</div><div class="line">	CHECK (<span class="string">"default"</span> <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</div><div class="line">);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"roles"</span> <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">'Moderator'</span>,<span class="number">0</span>,<span class="number">15</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"roles"</span> <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="string">'Administrator'</span>,<span class="number">0</span>,<span class="number">255</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"roles"</span> <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="string">'User'</span>,<span class="number">1</span>,<span class="number">7</span>);</div><div class="line"><span class="keyword">CREATE</span> TABLE users (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	email VARCHAR(<span class="number">64</span>),</div><div class="line">	username VARCHAR(<span class="number">64</span>),</div><div class="line">	role_id INTEGER,</div><div class="line">	password_hash VARCHAR(<span class="number">128</span>),</div><div class="line">	confirmed <span class="keyword">BOOLEAN</span>,</div><div class="line">	name VARCHAR(<span class="number">64</span>),</div><div class="line">	location VARCHAR(<span class="number">64</span>),</div><div class="line">	about_me TEXT,</div><div class="line">	member_since DATETIME,</div><div class="line">	last_seen DATETIME,</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	FOREIGN <span class="keyword">KEY</span>(role_id) REFERENCES roles (id),</div><div class="line">	CHECK (confirmed <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</div><div class="line">);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> ix_roles_default <span class="keyword">ON</span> roles (<span class="string">"default"</span>);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_email <span class="keyword">ON</span> users (email);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_username <span class="keyword">ON</span> users (username);</div><div class="line">COMMIT;</div><div class="line">sqlite&gt; ^D</div><div class="line">$ python manage.py runserver</div></pre></td></tr></table></figure>
<p>注册管理员邮箱<br><figure class="highlight n1ql"><table><tr><td class="code"><pre><div class="line">$ sqlite3 data-dev.sqlite</div><div class="line">SQLite version 3.8.10.2 2015-05-20 18:17:19</div><div class="line">Enter ".help" for usage hints.</div><div class="line">sqlite&gt; .dump</div><div class="line">PRAGMA foreign_keys=OFF;</div><div class="line">BEGIN TRANSACTION;</div><div class="line"><span class="keyword">CREATE</span> TABLE alembic_version (</div><div class="line">	version_num VARCHAR(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span></div><div class="line">);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"alembic_version"</span> <span class="keyword">VALUES</span>(<span class="string">'02ccb3e6a553'</span>);</div><div class="line"><span class="keyword">CREATE</span> TABLE roles (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	name VARCHAR(<span class="number">64</span>),</div><div class="line">	<span class="string">"default"</span> <span class="keyword">BOOLEAN</span>,</div><div class="line">	permissions INTEGER,</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	<span class="keyword">UNIQUE</span> (name),</div><div class="line">	CHECK (<span class="string">"default"</span> <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</div><div class="line">);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"roles"</span> <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">'Moderator'</span>,<span class="number">0</span>,<span class="number">15</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"roles"</span> <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="string">'Administrator'</span>,<span class="number">0</span>,<span class="number">255</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"roles"</span> <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="string">'User'</span>,<span class="number">1</span>,<span class="number">7</span>);</div><div class="line"><span class="keyword">CREATE</span> TABLE users (</div><div class="line">	id INTEGER <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">	email VARCHAR(<span class="number">64</span>),</div><div class="line">	username VARCHAR(<span class="number">64</span>),</div><div class="line">	role_id INTEGER,</div><div class="line">	password_hash VARCHAR(<span class="number">128</span>),</div><div class="line">	confirmed <span class="keyword">BOOLEAN</span>,</div><div class="line">	name VARCHAR(<span class="number">64</span>),</div><div class="line">	location VARCHAR(<span class="number">64</span>),</div><div class="line">	about_me TEXT,</div><div class="line">	member_since DATETIME,</div><div class="line">	last_seen DATETIME,</div><div class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (id),</div><div class="line">	FOREIGN <span class="keyword">KEY</span>(role_id) REFERENCES roles (id),</div><div class="line">	CHECK (confirmed <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">1</span>))</div><div class="line">);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">"users"</span> <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">'huamingrui@163.com'</span>,<span class="string">'MrHua'</span>,<span class="number">2</span>,<span class="string">'pbkdf2:sha1:1000$tSmBVC7j$6f3d994eb5b6b455347b56d3112a4cac26fc97e1'</span>,<span class="number">1</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="string">'2016-05-17 14:34:36.781740'</span>,<span class="string">'2016-05-17 14:52:08.764862'</span>);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> ix_roles_default <span class="keyword">ON</span> roles (<span class="string">"default"</span>);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_email <span class="keyword">ON</span> users (email);</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> ix_users_username <span class="keyword">ON</span> users (username);</div><div class="line">COMMIT;</div><div class="line">sqlite&gt;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/08/Spider-07-doctest/" itemprop="url">
                  Spider-07-doctest
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-08T11:43:23+08:00" content="2016-04-08">
              2016-04-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/08/Spider-07-doctest/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/08/Spider-07-doctest/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="知道创宇爬虫设计第七天-doctest"><a href="#知道创宇爬虫设计第七天-doctest" class="headerlink" title="知道创宇爬虫设计第七天: doctest"></a>知道创宇爬虫设计第七天: doctest</h1><p><code>doctest</code>是 Python 内建的模块，用于文档测试，正好可以拿来用于爬虫的自测功能</p>
<p>这个模块相对简单，直接贴代码</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">...</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">''' Prepare and run the spider</span></div><div class="line">    Self-test:</div><div class="line">    &gt;&gt;&gt; class Args(object):</div><div class="line">    ...     pass</div><div class="line">    ...</div><div class="line">    &gt;&gt;&gt; args = Args()</div><div class="line">    &gt;&gt;&gt; args.url = 'www.baidu.com'</div><div class="line">    &gt;&gt;&gt; args.depth = 1</div><div class="line">    &gt;&gt;&gt; args.logfile = 'testself.log'</div><div class="line">    &gt;&gt;&gt; args.loglevel = 4</div><div class="line">    &gt;&gt;&gt; args.dbfile = 'testself.db'</div><div class="line">    &gt;&gt;&gt; args.num_threads = 1</div><div class="line">    &gt;&gt;&gt; args.key = ''</div><div class="line">    &gt;&gt;&gt; set_logger(args.loglevel, args.logfile)</div><div class="line">    &gt;&gt;&gt; logger.info(vars(args))</div><div class="line">    &gt;&gt;&gt; spider = MySpider(args)</div><div class="line">    &gt;&gt;&gt; spider.run()</div><div class="line">    '''</div><div class="line">...</div><div class="line">    <span class="comment"># Self test</span></div><div class="line">    <span class="keyword">if</span> args.testself:</div><div class="line">        <span class="keyword">import</span> doctest</div><div class="line">        <span class="keyword">print</span> doctest.testmod()</div><div class="line">        <span class="keyword">return</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>另外其它部分也有少量修改，放在 <a href="https://github.com/answerrrrrrrrr/KnownsecSpider" target="_blank" rel="external">https://github.com/answerrrrrrrrr/KnownsecSpider</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014319170285543a4d04751f8846908770660de849f285000" target="_blank" rel="external">http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014319170285543a4d04751f8846908770660de849f285000</a></li>
<li><a href="http://devdocs.io/python~2.7/library/doctest#doctest.DocTest" target="_blank" rel="external">http://devdocs.io/python~2.7/library/doctest#doctest.DocTest</a></li>
<li><a href="http://devdocs.io/python~2.7/library/argparse#argparse.Namespace" target="_blank" rel="external">http://devdocs.io/python~2.7/library/argparse#argparse.Namespace</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/07/mysql-utf-8/" itemprop="url">
                  Mac 安装 MySQL 并设置 utf-8
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-07T22:23:29+08:00" content="2016-04-07">
              2016-04-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/07/mysql-utf-8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/07/mysql-utf-8/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><p><a href="http://dev.mysql.com/downloads/mysql/5.6.html" target="_blank" rel="external">http://dev.mysql.com/downloads/mysql/5.6.html</a></p>
<h1 id="关闭服务"><a href="#关闭服务" class="headerlink" title="关闭服务"></a>关闭服务</h1><p><code>系统偏好设置 - MySQL - Stop MySQL Server</code></p>
<h1 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ vim ~/.zshrc</div><div class="line"></div><div class="line">...</div><div class="line"># Add mysql</div><div class="line">export PATH=&quot;$PATH&quot;:/usr/local/mysql/bin</div><div class="line">...</div><div class="line"></div><div class="line">$ source ~/.zshrc</div></pre></td></tr></table></figure>
<h1 id="设置-utf-8"><a href="#设置-utf-8" class="headerlink" title="设置 utf-8"></a>设置 utf-8</h1><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sudo cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf</div><div class="line">$ sudo vim /etc/my.cnf</div><div class="line"></div><div class="line">...</div><div class="line">[client]</div><div class="line">default-character-set = utf8</div><div class="line"></div><div class="line">[mysqld]</div><div class="line">default-storage-engine = INNODB</div><div class="line">character-set-server = utf8</div><div class="line">collation-server = utf8_general_ci</div><div class="line">...</div></pre></td></tr></table></figure>
<h1 id="开启服务"><a href="#开启服务" class="headerlink" title="开启服务"></a>开启服务</h1><p><code>系统偏好设置 - MySQL - Start MySQL Server</code></p>
<h1 id="验证-utf-8"><a href="#验证-utf-8" class="headerlink" title="验证 utf-8"></a>验证 utf-8</h1><figure class="highlight asciidoc"><table><tr><td class="code"><pre><div class="line">$ mysql -u root -p</div><div class="line">Enter password:</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 5</div><div class="line">Server version: 5.6.29 MySQL Community Server (GPL)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="emphasis">'help;'</span> or <span class="emphasis">'\h'</span> for help. Type <span class="emphasis">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line"><span class="section">mysql&gt; show variables like '%char%';</span></div><div class="line">+--------------------------+--------------------------------------------------------+</div><div class="line"><span class="section">| Variable_name            | Value                                                  |</span></div><div class="line">+--------------------------+--------------------------------------------------------+</div><div class="line">| character<span class="emphasis">_set_</span>client     | utf8                                                   |</div><div class="line">| character<span class="emphasis">_set_</span>connection | utf8                                                   |</div><div class="line">| character<span class="emphasis">_set_</span>database   | utf8                                                   |</div><div class="line">| character<span class="emphasis">_set_</span>filesystem | binary                                                 |</div><div class="line">| character<span class="emphasis">_set_</span>results    | utf8                                                   |</div><div class="line">| character<span class="emphasis">_set_</span>server     | utf8                                                   |</div><div class="line">| character<span class="emphasis">_set_</span>system     | utf8                                                   |</div><div class="line"><span class="section">| character_sets_dir       | /usr/local/mysql-5.6.29-osx10.8-x86_64/share/charsets/ |</span></div><div class="line">+--------------------------+--------------------------------------------------------+</div><div class="line">8 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure>
<h1 id="mysql-connector"><a href="#mysql-connector" class="headerlink" title="mysql.connector"></a>mysql.connector</h1><figure class="highlight smali"><table><tr><td class="code"><pre><div class="line">(venv3.5)$ pip3 install mysql-connector-python-rf</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014320107391860b39da6901ed41a296e574ed37104752000" target="_blank" rel="external">http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014320107391860b39da6901ed41a296e574ed37104752000</a></li>
<li><a href="http://blog.csdn.net/waleking/article/details/7620983" target="_blank" rel="external">http://blog.csdn.net/waleking/article/details/7620983</a></li>
<li><a href="http://jingyan.baidu.com/article/48a42057e2b2b9a9242504a2.html" target="_blank" rel="external">http://jingyan.baidu.com/article/48a42057e2b2b9a9242504a2.html</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/07/Spider-06-requests/" itemprop="url">
                  Spider-06-requests
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-07T19:53:43+08:00" content="2016-04-07">
              2016-04-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/07/Spider-06-requests/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/07/Spider-06-requests/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="知道创宇爬虫设计第六天：requests"><a href="#知道创宇爬虫设计第六天：requests" class="headerlink" title="知道创宇爬虫设计第六天：requests"></a>知道创宇爬虫设计第六天：requests</h1><p>从实验室回学校之后，仅仅是换了个网络，却突然出现了乱码问题</p>
<p>折腾了半天编码无果，无意中发现把<code>urllib2</code>换成<code>requests</code>就好了<br>按照<code>requests</code><a href="http://www.python-requests.org/en/master/user/quickstart/" target="_blank" rel="external">官方文档</a>里的解释</p>
<blockquote>
<p>When you make a request, Requests makes educated guesses about the encoding of the response based on the HTTP headers. The text encoding guessed by Requests is used when you access r.text.</p>
</blockquote>
<p>难怪总在知乎看见人安利，确实是更好用一些啊。。。</p>
<p>具体用法也很简单方便<br>不过使用<code>request.text</code>返回结果时，标题依然会乱码</p>
<blockquote>
<p>You can also access the response body as bytes, for non-text requests</p>
</blockquote>
<p>改成使用<code>request.content</code>，果然一切正常了</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">...</div><div class="line">            <span class="comment"># request = urllib2.Request(url, headers=headers)</span></div><div class="line">            <span class="comment"># result = urllib2.urlopen(request).read()</span></div><div class="line"></div><div class="line">            request = requests.get(url, headers=headers)</div><div class="line">            <span class="comment"># result = request.text</span></div><div class="line">            result = request.content</div><div class="line">...</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://www.python-requests.org/en/master/" target="_blank" rel="external">http://www.python-requests.org/en/master/</a></li>
<li><a href="http://www.python-requests.org/en/master/user/quickstart/" target="_blank" rel="external">http://www.python-requests.org/en/master/user/quickstart/</a></li>
<li><a href="http://blog.csdn.net/alpha5/article/details/24964009" target="_blank" rel="external">http://blog.csdn.net/alpha5/article/details/24964009</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/06/Spider-05-Spider/" itemprop="url">
                  Spider-05-Spider
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-06T09:00:36+08:00" content="2016-04-06">
              2016-04-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/06/Spider-05-Spider/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/06/Spider-05-Spider/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="知道创宇爬虫设计第五天：Spider"><a href="#知道创宇爬虫设计第五天：Spider" class="headerlink" title="知道创宇爬虫设计第五天：Spider"></a>知道创宇爬虫设计第五天：Spider</h1><p> 准备工作完成的差不多了，今天尝试下把之前的模块都整合起来做一个初期版本</p>
<p> 首先 <a href="http://stackoverflow.com/questions/4327392/what-is-the-difference-between-web-crawling-and-web-scraping" target="_blank" rel="external">What is the difference between web-crawling and web-scraping?</a><br>感觉其实这个答案比最佳答案更简洁明了  </p>
<blockquote>
<p>Web Crawling is what Google does - it goes around a website looking at links and building a database of the layout of that site and sites it links to</p>
<p>Web Scraping would be the progamatic analysis of a web page to load some data off of it, EG loading up BBC weather and ripping (scraping) the weather forcast off of it and placing it elsewhere or using it in another program.</p>
</blockquote>
<p>我的理解就是<code>web-crawling</code>在于广度，<code>web-scraping</code>在于精度</p>
<h1 id="BeautifulSoup"><a href="#BeautifulSoup" class="headerlink" title="BeautifulSoup"></a>BeautifulSoup</h1><p>为了<code>crawl</code>，需要从页面提取出用于进一步爬取的 URL ，BeautifulSoup 正好能方便快捷地完成这个任务，上手也很简单，基本上看看<a href="http://beautifulsoup.readthedocs.org/zh_CN/latest/" target="_blank" rel="external">官方文档</a>就万事大吉了</p>
<h1 id="FileHandler"><a href="#FileHandler" class="headerlink" title="FileHandler"></a>FileHandler</h1><p>在整合 logger 的时候发现一个问题，使用<code>logging.config.fileConfig(&#39;logging.conf&#39;)</code>的话，需要提前在配置文件里写定日志保存路径，为了配合参数设定其他路径，似乎（看了一下 <a href="http://devdocs.io/python~2.7/library/logging.handlers#logging.FileHandler" target="_blank" rel="external">FileHandler</a> 的用法）只能额外添加一个了</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><div class="line">...</div><div class="line">    # If logfile is not <span class="string">'spider.log'</span></div><div class="line">    formatter = logging.Formatter(</div><div class="line">        <span class="string">'%(asctime)s - %(levelname)s - %(message)s'</span>)</div><div class="line">    file_handler.setFormatter(formatter)</div><div class="line">    logger.addHandler(file_handler)</div><div class="line">...</div></pre></td></tr></table></figure>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>目前爬虫已经基本能用，但偶尔还是会出现<code>502</code>，然后该往数据库里放些什么东西还有待考虑，另外也没有加上自测功能</p>
<figure class="highlight python"><figcaption><span>myspider.py</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</div><div class="line"><span class="keyword">from</span> Queue <span class="keyword">import</span> Queue</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">import</span> urllib2</div><div class="line"><span class="keyword">import</span> argparse</div><div class="line"><span class="keyword">import</span> sqlite3</div><div class="line"><span class="keyword">import</span> logging</div><div class="line"><span class="keyword">import</span> logging.config</div><div class="line"></div><div class="line"></div><div class="line">logging.config.fileConfig(<span class="string">'logging.conf'</span>)</div><div class="line">logger = logging.getLogger(<span class="string">'spider'</span>)</div><div class="line"></div><div class="line">levels = &#123;</div><div class="line">    <span class="number">1</span>: <span class="string">'CRITICAL'</span>,</div><div class="line">    <span class="number">2</span>: <span class="string">'ERROR'</span>,</div><div class="line">    <span class="number">3</span>: <span class="string">'WARNING'</span>,</div><div class="line">    <span class="number">4</span>: <span class="string">'INFO'</span>,</div><div class="line">    <span class="number">5</span>: <span class="string">'DEBUG'</span>,</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySqlite</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dbfile)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            logger.warning(<span class="string">"Open database %s"</span> % dbfile)</div><div class="line">            self.conn = sqlite3.connect(dbfile)</div><div class="line">        <span class="keyword">except</span> sqlite3.Error <span class="keyword">as</span> e:</div><div class="line">            <span class="comment"># print "Fail to connect %s: %s" % (dbfile, e) # e.args[0]</span></div><div class="line">            logger.error(<span class="string">"Fail to connect %s: %s"</span> % (dbfile, e))</div><div class="line">            <span class="keyword">return</span></div><div class="line"></div><div class="line">        self.cursor = self.conn.cursor()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, table)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            logger.warning(<span class="string">"Create table %s if not exists"</span> % table)</div><div class="line">            self.cursor.execute(</div><div class="line">                <span class="string">"CREATE TABLE IF NOT EXISTS %s (id INTEGER PRIMARY KEY \</span></div><div class="line">                AUTOINCREMENT, url VARCHAR(100), data VARCHAR(40))" % table)</div><div class="line">            self.conn.commit()</div><div class="line">        <span class="keyword">except</span> sqlite3.Error <span class="keyword">as</span> e:</div><div class="line">            logger.error(<span class="string">"Fail to create %s: %s"</span> % (table, e))</div><div class="line">            self.conn.rollback()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, table, url, data)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            logger.warning(</div><div class="line">                <span class="string">"Insert (%s, %s) into table %s"</span> % (url, data, table))</div><div class="line">            self.cursor.execute(</div><div class="line">                <span class="string">"INSERT INTO %s (url, data) VALUES ('%s', '%s')"</span> %</div><div class="line">                (table, url, data))</div><div class="line">            self.conn.commit()</div><div class="line">        <span class="keyword">except</span> sqlite3.Error <span class="keyword">as</span> e:</div><div class="line">            logger.error(</div><div class="line">                <span class="string">"Fail to insert (%s, %s) into %s: %s"</span> %</div><div class="line">                (url, data, table, e))</div><div class="line">            self.conn.rollback()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></div><div class="line">        logger.info(<span class="string">"Close database"</span>)</div><div class="line">        self.cursor.close()</div><div class="line">        self.conn.close()</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThreadPool</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_threads=<span class="number">10</span>)</span>:</span></div><div class="line">        self.tasks = Queue(num_threads)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, num_threads+<span class="number">1</span>):</div><div class="line">            <span class="comment"># Initialize the pool with the number of num_threads</span></div><div class="line">            logger.info(<span class="string">'Initialize thread %d'</span> % i)</div><div class="line">            MyThread(self.tasks)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_task</span><span class="params">(self, func, *args, **kwargs)</span>:</span></div><div class="line">        self.tasks.put((func, args, kwargs))</div><div class="line">        logger.debug(<span class="string">'Add task'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait_completion</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="comment"># Blocks until all items in the queue have been gotten and processed.</span></div><div class="line">        self.tasks.join()</div><div class="line">        logger.info(<span class="string">'All tasks are done'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(Thread)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, tasks)</span>:</span></div><div class="line">        Thread.__init__(self)</div><div class="line">        self.tasks = tasks</div><div class="line">        <span class="comment"># This must be set before start() is called. The entire Python program</span></div><div class="line">        <span class="comment"># exits when no alive non-daemon threads are left.</span></div><div class="line">        self.daemon = <span class="keyword">True</span></div><div class="line">        self.start()</div><div class="line">        logger.debug(<span class="string">'Thread started...'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="comment"># Block until an item is available.</span></div><div class="line">            func, args, kwargs = self.tasks.get()</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                logger.warning(<span class="string">'Thread is working...'</span>)</div><div class="line">                func(*args, **kwargs)</div><div class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                logger.error(e)</div><div class="line">            <span class="comment"># Tells the queue that the processing on the task is complete.</span></div><div class="line">            self.tasks.task_done()</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySpider</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, args)</span>:</span></div><div class="line">        <span class="string">''' Initialize the spider</span></div><div class="line">        '''</div><div class="line">        <span class="comment"># Initialize args</span></div><div class="line">        self.url = args.url</div><div class="line">        self.depth = args.depth</div><div class="line">        self.logfile = args.logfile</div><div class="line">        self.dbfile = args.dbfile</div><div class="line">        self.num_threads = args.num_threads</div><div class="line">        self.key = args.key.lower()</div><div class="line">        self.selftest = args.selftest</div><div class="line"></div><div class="line">        <span class="comment"># Store visited url</span></div><div class="line">        self.visited_urls = set()</div><div class="line"></div><div class="line">        <span class="comment"># Initialize threadpool</span></div><div class="line">        self.threadpool = MyThreadPool(self.num_threads)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">''' Run the spider</span></div><div class="line">        '''</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.url.startswith(<span class="string">'http://'</span>):</div><div class="line">            self.url = <span class="string">'http://'</span> + self.url</div><div class="line">        logger.critical(<span class="string">'Start crawl on %s'</span> % self.url)</div><div class="line">        self.threadpool.add_task(self.scrape, self.url, self.depth)</div><div class="line">        self.threadpool.wait_completion()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">scrape</span><span class="params">(self, url, depth)</span>:</span></div><div class="line">        <span class="string">''' Scrape the content of page</span></div><div class="line">        '''</div><div class="line">        <span class="comment"># Open database with dbfile</span></div><div class="line">        db = MySqlite(self.dbfile)</div><div class="line">        <span class="comment"># Create table with keyword</span></div><div class="line">        table = <span class="string">'none'</span> <span class="keyword">if</span> <span class="keyword">not</span> self.key <span class="keyword">else</span> self.key</div><div class="line">        db.create(table)</div><div class="line"></div><div class="line">        <span class="comment"># Avoid being recognized as robot</span></div><div class="line">        headers = &#123;</div><div class="line">            <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) \</span></div><div class="line">            AppleWebKit/537.36 (KHTML, like Gecko) \</div><div class="line">            Chrome/49.0.2623.110 Safari/537.36'</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment"># Avoid repeat</span></div><div class="line">        <span class="keyword">if</span> url <span class="keyword">in</span> self.visited_urls:</div><div class="line">            logger.debug(<span class="string">'%s had been crawled'</span> % url)</div><div class="line">            <span class="keyword">return</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.visited_urls.add(url)</div><div class="line">            logger.info(<span class="string">'Crawling on %s'</span> % url)</div><div class="line"></div><div class="line">        <span class="comment"># Request with headers</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            logger.warning(<span class="string">'Open %s'</span> % url)</div><div class="line">            request = urllib2.Request(url, headers=headers)</div><div class="line">            result = urllib2.urlopen(request).read()</div><div class="line">        <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</div><div class="line">            logger.error(e)</div><div class="line">            <span class="keyword">return</span></div><div class="line"></div><div class="line">        <span class="comment"># Extract the title by BeautifulSoup</span></div><div class="line">        soup = BeautifulSoup(result, <span class="string">"lxml"</span>)</div><div class="line">        title = soup.title.string</div><div class="line">        logger.debug(<span class="string">'title = %s'</span> % title)</div><div class="line"></div><div class="line">        <span class="comment"># Store url and title of the page with keyword into database</span></div><div class="line">        <span class="keyword">if</span> self.key <span class="keyword">in</span> result.lower():</div><div class="line">            table = <span class="string">'none'</span> <span class="keyword">if</span> <span class="keyword">not</span> self.key <span class="keyword">else</span> self.key</div><div class="line">            db.insert(table, url, title)</div><div class="line">            logger.critical(</div><div class="line">                <span class="string">'KEYWORD:\'%s\' - URL:\'%s\' - TITLE:\'%s\' (DEPTH:%d)'</span> %</div><div class="line">                (self.key, url, title, depth))</div><div class="line"></div><div class="line">        <span class="comment"># Close database after modification</span></div><div class="line">        db.close()</div><div class="line"></div><div class="line">        <span class="comment"># Go deeper into urls in result</span></div><div class="line">        self.crawl(soup, depth<span class="number">-1</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crawl</span><span class="params">(self, soup, depth)</span>:</span></div><div class="line">        <span class="string">''' Crawl to new pages</span></div><div class="line">        '''</div><div class="line">        <span class="keyword">if</span> depth &gt; <span class="number">0</span>:</div><div class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> soup.find_all(<span class="string">'a'</span>):</div><div class="line">                url = link.get(<span class="string">'href'</span>)</div><div class="line">                <span class="comment"># scrape new url</span></div><div class="line">                self.threadpool.add_task(self.scrape, url, depth)</div><div class="line"></div><div class="line">    <span class="comment"># def stop(self):</span></div><div class="line">    <span class="comment">#     ''' Stop the spider</span></div><div class="line">    <span class="comment">#     '''</span></div><div class="line">    <span class="comment">#     logger.critical('OVER')</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">args_parser</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">''' Parse the args</span></div><div class="line">    '''</div><div class="line">    parser = argparse.ArgumentParser()</div><div class="line"></div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-u'</span>, <span class="string">'--url'</span>, dest=<span class="string">'url'</span>, required=<span class="keyword">True</span>,</div><div class="line">        help=<span class="string">'specify the URL to start crawl'</span></div><div class="line">    )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-d'</span>, <span class="string">'--depth'</span>, dest=<span class="string">'depth'</span>, default=<span class="number">1</span>, type=int,</div><div class="line">        help=<span class="string">'specify the depth of the spider (default: 1)'</span></div><div class="line">    )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-f'</span>, <span class="string">'--file'</span>, dest=<span class="string">'logfile'</span>, default=<span class="string">'spider.log'</span>,</div><div class="line">        help=<span class="string">'specify the path of logfile (default: spider.log)'</span></div><div class="line">    )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-l'</span>, <span class="string">'--level'</span>, dest=<span class="string">'loglevel'</span>, default=<span class="number">5</span>, type=int,</div><div class="line">        choices=range(<span class="number">1</span>, <span class="number">6</span>),</div><div class="line">        help=<span class="string">'specify the verbose level of the log (default: 5)'</span></div><div class="line">    )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--dbfile'</span>, dest=<span class="string">'dbfile'</span>, default=<span class="string">'spider.db'</span>,</div><div class="line">        help=<span class="string">'specify the path of sqlite dbfile (default: spider.db)'</span></div><div class="line">    )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--thread'</span>, dest=<span class="string">'num_threads'</span>, default=<span class="number">10</span>, type=int,</div><div class="line">        help=<span class="string">'specify the size of thread pool (default: 10)'</span></div><div class="line">    )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--key'</span>, dest=<span class="string">'key'</span>, default=<span class="string">''</span>,</div><div class="line">        help=<span class="string">'specify the keyword (default: '</span><span class="string">')'</span></div><div class="line">    )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--selftest'</span>, action=<span class="string">'store_true'</span>,</div><div class="line">        help=<span class="string">'self-test'</span></div><div class="line">    )</div><div class="line"></div><div class="line">    args = parser.parse_args()</div><div class="line">    <span class="keyword">return</span> args</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_logger</span><span class="params">(loglevel, logfile)</span>:</span></div><div class="line">    <span class="string">''' Set the logger with loglevel and logfile</span></div><div class="line">    '''</div><div class="line">    logger.setLevel(levels[loglevel])</div><div class="line">    file_handler = logging.FileHandler(logfile)</div><div class="line"></div><div class="line">    <span class="comment"># If logfile is not 'spider.log'</span></div><div class="line">    formatter = logging.Formatter(</div><div class="line">        <span class="string">'%(asctime)s - %(levelname)s - %(message)s'</span>)</div><div class="line">    file_handler.setFormatter(formatter)</div><div class="line">    logger.addHandler(file_handler)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    args = args_parser()</div><div class="line">    set_logger(args.loglevel, args.logfile)</div><div class="line">    logger.debug(args)</div><div class="line"></div><div class="line">    spider = MySpider(args)</div><div class="line">    spider.run()</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://beautifulsoup.readthedocs.org/zh_CN/latest/" target="_blank" rel="external">http://beautifulsoup.readthedocs.org/zh_CN/latest/</a></li>
<li><a href="http://devdocs.io/python~2.7/library/logging.handlers#logging.FileHandler" target="_blank" rel="external">http://devdocs.io/python~2.7/library/logging.handlers#logging.FileHandler</a></li>
<li><a href="http://dongweiming.github.io/blog/archives/pa-chong-lian-xi/" target="_blank" rel="external">http://dongweiming.github.io/blog/archives/pa-chong-lian-xi/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/05/Sublime-Packages/" itemprop="url">
                  Sublime Preferences
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-05T16:24:00+08:00" content="2016-04-05">
              2016-04-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Sublime/" itemprop="url" rel="index">
                    <span itemprop="name">Sublime</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/05/Sublime-Packages/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/05/Sublime-Packages/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="切换标签页"><a href="#切换标签页" class="headerlink" title="切换标签页"></a>切换标签页</h1><p>首先，Sublime 的所谓「标签页智能切换」很蛋疼，改成通用快捷键设定</p>
<figure class="highlight js"><figcaption><span>Default (OSX).sublime-keymap</span></figcaption><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"keys"</span>: [<span class="string">"ctrl+tab"</span>],</div><div class="line">    <span class="string">"command"</span>: <span class="string">"next_view"</span></div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">    <span class="string">"keys"</span>: [<span class="string">"ctrl+shift+tab"</span>],</div><div class="line">    <span class="string">"command"</span>: <span class="string">"prev_view"</span></div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<h1 id="Vintage"><a href="#Vintage" class="headerlink" title="Vintage"></a><a href="https://github.com/sublimehq/Vintage" target="_blank" rel="external">Vintage</a></h1><p>这个是Sublime自带的vi模式<br>先注释掉<code>Preferences.sublime-settings</code>里的<code>Vintage</code></p>
<figure class="highlight js"><figcaption><span>Preferences.sublime-settings</span></figcaption><table><tr><td class="code"><pre><div class="line">...</div><div class="line">    <span class="string">"ignored_packages"</span>:[</div><div class="line">        <span class="comment">// "Vintage"</span></div><div class="line">    ],</div><div class="line">...</div></pre></td></tr></table></figure>
<p>再按照习惯把<code>esc</code>改成<code>j</code> <code>j</code></p>
<figure class="highlight js"><figcaption><span>Default (OSX).sublime-keymap</span></figcaption><table><tr><td class="code"><pre><div class="line">...</div><div class="line"><span class="comment">// Vintage</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">"keys"</span>: [<span class="string">"j"</span>, <span class="string">"j"</span>],</div><div class="line">        <span class="string">"command"</span>: <span class="string">"exit_insert_mode"</span>,</div><div class="line">        <span class="string">"context"</span>:[</div><div class="line">            &#123;</div><div class="line">                <span class="string">"key"</span>: <span class="string">"setting.command_mode"</span>,</div><div class="line">                <span class="string">"operand"</span>: <span class="literal">false</span></div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                <span class="string">"key"</span>: <span class="string">"setting.is_widget"</span>,</div><div class="line">                <span class="string">"operand"</span>: <span class="literal">false</span></div><div class="line">            &#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">...</div></pre></td></tr></table></figure>
<p>另外还有一个<a href="https://github.com/SublimeText/VintageEx" target="_blank" rel="external">VintageEx</a>，不过我倒是没有太大需求</p>
<h1 id="SublimeREPL"><a href="#SublimeREPL" class="headerlink" title="SublimeREPL"></a><a href="https://github.com/wuub/SublimeREPL" target="_blank" rel="external">SublimeREPL</a></h1><p>无意中发现一个类似 Vim 下 quickrun 的插件<code>SublimeREPL</code></p>
<p>在<code>Perferences</code>-<code>Key Bindings - User</code>中加入</p>
<figure class="highlight js"><figcaption><span>Default (OSX).sublime-keymap</span></figcaption><table><tr><td class="code"><pre><div class="line">...</div><div class="line">    <span class="comment">// SublimeREPL - Python</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">"keys"</span>: [<span class="string">"f2"</span>],</div><div class="line">        <span class="string">"caption"</span>: <span class="string">"SublimeREPL: Python - RUN current file"</span>,</div><div class="line">        <span class="string">"command"</span>: <span class="string">"run_existing_window_command"</span>,</div><div class="line">        <span class="string">"args"</span>: &#123;</div><div class="line">            <span class="string">"id"</span>: <span class="string">"repl_python_run"</span>,</div><div class="line">            <span class="string">"file"</span>: <span class="string">"config/Python/Main.sublime-menu"</span>,</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">...</div></pre></td></tr></table></figure>
<p>这样一来，保存之后按<code>F2</code>即可快速运行 Python 脚本，不用来回切换终端了<br>C’est bon!</p>
<h1 id="ExpandRegion"><a href="#ExpandRegion" class="headerlink" title="ExpandRegion"></a><a href="https://github.com/aronwoost/sublime-expand-region" target="_blank" rel="external">ExpandRegion</a></h1><p>在<a href="https://www.zhihu.com/question/24896283" target="_blank" rel="external">知乎</a>看到推荐感觉挺不错，用于快速扩展选区，也是在<code>Perferences</code>-<code>Key Bindings - User</code>中加入</p>
<figure class="highlight js"><figcaption><span>Default (OSX).sublime-keymap</span></figcaption><table><tr><td class="code"><pre><div class="line">...</div><div class="line">    &#123;</div><div class="line">        <span class="string">"keys"</span>: [<span class="string">"super+e"</span>],</div><div class="line">        <span class="string">"command"</span>: <span class="string">"expand_region"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="string">"keys"</span>: [<span class="string">"super+u"</span>],</div><div class="line">        <span class="string">"command"</span>: <span class="string">"expand_region"</span>,</div><div class="line">        <span class="string">"args"</span>: &#123;</div><div class="line">            <span class="string">"undo"</span>: <span class="literal">true</span></div><div class="line">        &#125;,</div><div class="line">        <span class="string">"context"</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="string">"key"</span>: <span class="string">"expand_region_soft_undo"</span></div><div class="line">            &#125;</div><div class="line">        ]</div><div class="line">    &#125;,</div><div class="line">...</div></pre></td></tr></table></figure>
<h1 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a><a href="https://github.com/DamnWidget/anaconda" target="_blank" rel="external">Anaconda</a></h1><p>这个插件确实强大，不过有点小问题</p>
<h2 id="import-时不能自动补全"><a href="#import-时不能自动补全" class="headerlink" title="import 时不能自动补全"></a>import 时不能自动补全</h2><p>在<a href="https://github.com/DamnWidget/anaconda/issues/89" target="_blank" rel="external">Stackoverflow</a>找到解决方案<br>新建<code>/Users/air9/Library/Application\ Support/Sublime\ Text\ 3/Packages/Python/Completion\ Rules.tmPreferences</code>并加入如下内容</p>
<figure class="highlight xml"><figcaption><span>Completion Rules.tmPreferences</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>scope<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>source.python<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>settings<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>cancelCompletion<span class="tag">&lt;/<span class="name">key</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>^(.*\b(and|or)$)|(\s*(pass|return|and|or|(class|def)\s*[a-zA-Z_0-9]+)$)<span class="tag">&lt;/<span class="name">string</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></div></pre></td></tr></table></figure>
<p>保存后重启 Sublime 即可</p>
<p><strong>不过第一次弄的时候，不知道怎么回事出现了配置文件被初始化的 bug，所有插件和改键都失效了。。。还好我碰巧刚刚做了备份，所以下次也要记得先备份一下</strong></p>
<h2 id="过于频繁的补全弹窗"><a href="#过于频繁的补全弹窗" class="headerlink" title="过于频繁的补全弹窗"></a>过于频繁的补全弹窗</h2><p>随便按一个空格就以<code>a</code>开头弹窗提示我补全，有时甚至回车补全完成之后弹窗仍然消失不掉，一怒之下禁用掉了</p>
<figure class="highlight js"><figcaption><span>Anaconda.sublime-settings</span></figcaption><table><tr><td class="code"><pre><div class="line">...</div><div class="line">    <span class="comment">/*</span></div><div class="line">        Disable anaconda completion</div><div class="line"></div><div class="line">        WARNING: set this as true will totally disable anaconda completion</div><div class="line">    */</div><div class="line">    <span class="comment">// "disable_anaconda_completion": false,</span></div><div class="line">    <span class="string">"disable_anaconda_completion"</span>: <span class="literal">true</span>,</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>Sublime 自带的轻量级补全其实已经满足我的日常需求了，装 Anaconda 主要还是为了 Tooltip 和 PEP8 提示</p>
<h1 id="MarkdownEditing"><a href="#MarkdownEditing" class="headerlink" title="MarkdownEditing"></a><a href="https://github.com/SublimeText-Markdown/MarkdownEditing" target="_blank" rel="external">MarkdownEditing</a></h1><p>这个其实用处不大，平常在 Mac 上写 Markdown 都用的 MacDown<br>不过默认会渲染 txt 还是挺蛋疼的，注释掉<br>顺便改个主题</p>
<figure class="highlight js"><figcaption><span>Markdown.sublime-settings</span></figcaption><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"extensions"</span>:</div><div class="line">    [</div><div class="line">        <span class="string">"md"</span>,</div><div class="line">        <span class="string">"mdown"</span>,</div><div class="line">        <span class="comment">// "txt"</span></div><div class="line">    ],</div><div class="line"></div><div class="line">    <span class="string">"color_scheme"</span>: <span class="string">"Packages/MarkdownEditing/MarkdownEditor-Dark.tmTheme"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/05/Spider-04-sqlite/" itemprop="url">
                  Spider-04-sqlite3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-05T09:39:06+08:00" content="2016-04-05">
              2016-04-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/05/Spider-04-sqlite/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/05/Spider-04-sqlite/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="知道创宇爬虫设计第四天：sqlite3"><a href="#知道创宇爬虫设计第四天：sqlite3" class="headerlink" title="知道创宇爬虫设计第四天：sqlite3"></a>知道创宇爬虫设计第四天：sqlite3</h1><p>这部分比较简单，需要注意的几点</p>
<ul>
<li>connect, cursor</li>
<li>execute</li>
<li>commit, rollback</li>
<li>close</li>
</ul>
<p>既然之前已经学会了使用logging，就可以尝试下配合着使用</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><figcaption><span>MySqlite.py</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> sqlite3</div><div class="line"><span class="keyword">import</span> logging</div><div class="line"><span class="keyword">import</span> logging.config</div><div class="line">logging.config.fileConfig(<span class="string">'logging.conf'</span>)</div><div class="line"></div><div class="line"></div><div class="line">levels = &#123;</div><div class="line">    <span class="number">1</span>: <span class="string">'CRITICAL'</span>,</div><div class="line">    <span class="number">2</span>: <span class="string">'ERROR'</span>,</div><div class="line">    <span class="number">3</span>: <span class="string">'WARNING'</span>,</div><div class="line">    <span class="number">4</span>: <span class="string">'INFO'</span>,</div><div class="line">    <span class="number">5</span>: <span class="string">'DEBUG'</span>,</div><div class="line">&#125;</div><div class="line">loglevel = <span class="number">4</span></div><div class="line">logger = logging.getLogger(<span class="string">'spider'</span>)</div><div class="line">logger.setLevel(levels[loglevel])</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySqlite</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dbfile)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            self.conn = sqlite3.connect(dbfile)</div><div class="line">            logger.info(<span class="string">"Open database %s"</span> % dbfile)</div><div class="line">            logger.debug(<span class="string">"Open database %s"</span> % dbfile)</div><div class="line">        <span class="keyword">except</span> sqlite3.Error <span class="keyword">as</span> e:</div><div class="line">            <span class="comment"># print "Fail to connect %s: %s" % (dbfile, e) # e.args[0]</span></div><div class="line">            logger.error(<span class="string">"Fail to connect %s: %s"</span> % (dbfile, e))</div><div class="line">            <span class="keyword">return</span></div><div class="line"></div><div class="line">        self.cursor = self.conn.cursor()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, table)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            logger.info(<span class="string">"Create table %s"</span> % table)</div><div class="line">            self.cursor.execute(</div><div class="line">                <span class="string">"CREATE TABLE IF NOT EXISTS %s(Id INTEGER PRIMARY KEY \</span></div><div class="line">                AUTOINCREMENT, Data VARCHAR(40))" % table</div><div class="line">                )</div><div class="line">            self.conn.commit()</div><div class="line">        <span class="keyword">except</span> sqlite3.Error <span class="keyword">as</span> e:</div><div class="line">            logger.error(<span class="string">"Fail to create %s: %s"</span> % (table, e))</div><div class="line">            self.conn.rollback()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, table, data)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            logger.info(<span class="string">"Insert %s into table %s"</span> % (data, table))</div><div class="line">            self.cursor.execute(</div><div class="line">                <span class="string">"INSERT INTO %s(Data) VALUES('%s')"</span> % (table, data))</div><div class="line">            self.conn.commit()</div><div class="line">        <span class="keyword">except</span> sqlite3.Error <span class="keyword">as</span> e:</div><div class="line">            logger.error(<span class="string">"Fail to insert %s into %s: %s"</span> % (data, table, e))</div><div class="line">            self.conn.rollback()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></div><div class="line">        logger.info(<span class="string">"Close database"</span>)</div><div class="line">        self.cursor.close()</div><div class="line">        self.conn.close()</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    ms = MySqlite(<span class="string">'spider.db'</span>)</div><div class="line">    ms.create(<span class="string">'t1'</span>)</div><div class="line">    ms.insert(<span class="string">'t1'</span>, <span class="string">'test'</span>)</div><div class="line">    ms.close()</div></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>logging.conf</span></figcaption><table><tr><td class="code"><pre><div class="line">[loggers]</div><div class="line">keys = root, spider</div><div class="line"></div><div class="line">[handlers]</div><div class="line">keys = consoleHandler, fileHandler</div><div class="line"></div><div class="line">[formatters]</div><div class="line">keys = simpleFormatter</div><div class="line"></div><div class="line">[logger_root]</div><div class="line">level = DEBUG</div><div class="line">handlers = consoleHandler</div><div class="line"></div><div class="line">[logger_spider]</div><div class="line">level = DEBUG</div><div class="line">handlers = consoleHandler, fileHandler</div><div class="line">qualname = spider</div><div class="line">propagate = 0</div><div class="line"></div><div class="line">[handler_consoleHandler]</div><div class="line">class = StreamHandler</div><div class="line">level = DEBUG</div><div class="line">formatter = simpleFormatter</div><div class="line">args = (sys.stdout,)</div><div class="line"></div><div class="line">[handler_fileHandler]</div><div class="line">class = FileHandler</div><div class="line">level = DEBUG</div><div class="line">formatter = simpleFormatter</div><div class="line">args = (&apos;spider.log&apos;, &apos;w&apos;)</div><div class="line"></div><div class="line">[formatter_simpleFormatter]</div><div class="line">format = %(asctime)s - %(name)s - %(levelname)s - %(message)s</div><div class="line">datefmt =</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://docs.python.org/2/library/sqlite3.html" target="_blank" rel="external">https://docs.python.org/2/library/sqlite3.html</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_72603eac01013pbc.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_72603eac01013pbc.html</a></li>
<li><a href="http://blog.csdn.net/jeepxiaozi/article/details/8808435" target="_blank" rel="external">http://blog.csdn.net/jeepxiaozi/article/details/8808435</a></li>
<li><a href="http://dongweiming.github.io/blog/archives/pa-chong-lian-xi/" target="_blank" rel="external">http://dongweiming.github.io/blog/archives/pa-chong-lian-xi/</a></li>
<li><a href="http://devdocs.io/python~2.7/library/logging.config" target="_blank" rel="external">http://devdocs.io/python~2.7/library/logging.config</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/04/Spider-03-argparse/" itemprop="url">
                  Spider-03-argparse
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-04T15:39:12+08:00" content="2016-04-04">
              2016-04-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/04/Spider-03-argparse/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/04/Spider-03-argparse/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="知道创宇爬虫设计第三天：argparse"><a href="#知道创宇爬虫设计第三天：argparse" class="headerlink" title="知道创宇爬虫设计第三天：argparse"></a>知道创宇爬虫设计第三天：argparse</h1><p>题目原本是2012年的，要求的optparse模块已经过时，因此按照argparse来学习</p>
<p>提取要点如下：</p>
<ul>
<li><code>class argparse.ArgumentParser(prog=None, usage=None, description=None, epilog=None, parents=[], formatter_class=argparse.HelpFormatter, prefix_chars=&#39;-&#39;, fromfile_prefix_chars=None, argument_default=None, conflict_handler=&#39;error&#39;, add_help=True)</code></li>
<li><code>ArgumentParser.add_argument(name or flags...[, action][, nargs][, const][, default][, type][, choices][, required][, help][, metavar][, dest])</code></li>
<li>ArgumentParser通过parse_args()方法解析参数。它将检查命令行，把每个参数转换成恰当的类型并采取恰当的动作。在大部分情况下，这意味着将从命令行中解析出来的属性建立一个简单的 Namespace对象</li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> argparse</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">()</span>:</span></div><div class="line">    parser = argparse.ArgumentParser()</div><div class="line"></div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-u'</span>, <span class="string">'--url'</span>, dest=<span class="string">'url'</span>, required=<span class="keyword">True</span>,</div><div class="line">        help=<span class="string">'specify the URL to start crawl'</span></div><div class="line">        )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-d'</span>, <span class="string">'--depth'</span>, dest=<span class="string">'depth'</span>,</div><div class="line">        default=<span class="number">1</span>, type=int,</div><div class="line">        help=<span class="string">'specify the depth of the spider (default: 1)'</span></div><div class="line">        )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-f'</span>, <span class="string">'--file'</span>, dest=<span class="string">'logfile'</span>,</div><div class="line">        default=<span class="string">'spider.log'</span>,</div><div class="line">        help=<span class="string">'specify the path of logfile (default: spider.log)'</span></div><div class="line">        )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'-l'</span>, <span class="string">'--level'</span>, dest=<span class="string">'loglevel'</span>, choices=range(<span class="number">1</span>, <span class="number">6</span>),</div><div class="line">        default=<span class="number">1</span>, type=int,</div><div class="line">        help=<span class="string">'specify the verbose level of the log (default: 1)'</span></div><div class="line">        )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--dbfile'</span>, dest=<span class="string">'dbfile'</span>,</div><div class="line">        default=<span class="string">'spider.db'</span>,</div><div class="line">        help=<span class="string">'specify the path of sqlite dbfile (default: spider.db)'</span></div><div class="line">        )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--thread'</span>, dest=<span class="string">'num_threads'</span>,</div><div class="line">        default=<span class="number">10</span>, type=int,</div><div class="line">        help=<span class="string">'specify the size of thread pool (default: 10)'</span></div><div class="line">        )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--keyword'</span>, dest=<span class="string">'keyword'</span>,</div><div class="line">        help=<span class="string">'specify the keyword'</span></div><div class="line">        )</div><div class="line">    parser.add_argument(</div><div class="line">        <span class="string">'--selftest'</span>, action=<span class="string">'store_true'</span>,</div><div class="line">        help=<span class="string">'self-test'</span></div><div class="line">        )</div><div class="line"></div><div class="line">    args = parser.parse_args()</div><div class="line">    <span class="comment"># &gt; Namespace(</span></div><div class="line">    <span class="comment">#     dbfile='spider.db', depth=1, keyword=None,</span></div><div class="line">    <span class="comment">#     logfile='spider.log', loglevel=1, num_threads=10,</span></div><div class="line">    <span class="comment">#     selftest=False, url='www.baidu.com'</span></div><div class="line">    <span class="comment">#     )</span></div><div class="line">    <span class="keyword">return</span> args</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    parse()</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://docs.python.org/2/howto/argparse.html" target="_blank" rel="external">https://docs.python.org/2/howto/argparse.html</a></li>
<li><a href="https://docs.python.org/2/library/argparse.html#choices" target="_blank" rel="external">https://docs.python.org/2/library/argparse.html#choices</a></li>
<li><a href="http://python.usyiyi.cn/python_278/library/argparse.html" target="_blank" rel="external">http://python.usyiyi.cn/python_278/library/argparse.html</a></li>
<li><a href="http://blog.xiayf.cn/2013/03/30/argparse/" target="_blank" rel="external">http://blog.xiayf.cn/2013/03/30/argparse/</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/03/Spider-02-logging/" itemprop="url">
                  Spider-02-logging
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-03T21:42:37+08:00" content="2016-04-03">
              2016-04-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/03/Spider-02-logging/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/03/Spider-02-logging/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="知道创宇爬虫设计第二天：logging"><a href="#知道创宇爬虫设计第二天：logging" class="headerlink" title="知道创宇爬虫设计第二天：logging"></a>知道创宇爬虫设计第二天：logging</h1><p><a href="http://blog.chinaunix.net/uid-26000296-id-4372063.html" target="_blank" rel="external">此文章</a>的测试用例详细实用，对logging模块的解析也很不错，现把自己理解的要点摘录如下</p>
<ul>
<li>只要logging.getLogger(name)中名称参数name相同则返回的Logger实例就是同一个，且仅有一个，也即name与Logger实例一一对应</li>
<li>子孙既会将消息分发给他的handler进行处理，也会传递给所有的祖先Logger处理</li>
<li>若为Handler加Filter则所有使用了该Handler的Logger都会受到影响。而为Logger添加Filter只会影响到自身</li>
<li>典型的多模块场景下使用logging的方式，是在main模块中配置logging，这个配置会作用于其所有子模块</li>
<li>使用配置文件<code>logging.config.fileConfig(&quot;logging.conf&quot;)</code>(<a href="http://my.oschina.net/leejun2005/blog/126713" target="_blank" rel="external">来源</a>)</li>
</ul>
<figure class="highlight"><figcaption><span>logging.conf</span></figcaption><table><tr><td class="code"><pre><div class="line"># 定义logger模块，root是父类，必需存在的，其它的是自定义。</div><div class="line"># logging.getLogger(NAME)便相当于向logging模块注册了一种日志打印</div><div class="line"># name 中用 . 表示 log 的继承关系</div><div class="line">[loggers]</div><div class="line">keys=root,infoLogger,errorLogger</div><div class="line"> </div><div class="line"># 定义handler</div><div class="line">[handlers]</div><div class="line">keys=infoHandler,errorHandler</div><div class="line"> </div><div class="line"># 定义格式化输出</div><div class="line">[formatters]</div><div class="line">keys=infoFmt,errorFmt</div><div class="line"> </div><div class="line">#--------------------------------------------------</div><div class="line"># 实现上面定义的logger模块，必需是[logger_xxxx]这样的形式</div><div class="line">#--------------------------------------------------</div><div class="line"># [logger_xxxx] logger_模块名称</div><div class="line"># level     级别，级别有DEBUG、INFO、WARNING、ERROR、CRITICAL</div><div class="line"># handlers  处理类，可以有多个，用逗号分开</div><div class="line"># qualname  logger名称，应用程序通过 logging.getLogger获取。对于不能获取的名称，则记录到root模块。</div><div class="line"># propagate 是否继承父类的log信息，0:否 1:是</div><div class="line">[logger_root]</div><div class="line">level=INFO</div><div class="line">handlers=errorHandler</div><div class="line"> </div><div class="line">[logger_errorLogger]</div><div class="line">level=ERROR</div><div class="line">handlers=errorHandler</div><div class="line">propagate=0</div><div class="line">qualname=errorLogger</div><div class="line"> </div><div class="line">[logger_infoLogger]</div><div class="line">level=INFO</div><div class="line">handlers=infoHandler</div><div class="line">propagate=0</div><div class="line">qualname=infoLogger</div><div class="line"> </div><div class="line">#--------------------------------------------------</div><div class="line"># handler</div><div class="line">#--------------------------------------------------</div><div class="line"># [handler_xxxx]</div><div class="line"># class handler类名</div><div class="line"># level 日志级别</div><div class="line"># formatter，上面定义的formatter</div><div class="line"># args handler初始化函数参数</div><div class="line"> </div><div class="line">[handler_infoHandler]</div><div class="line">class=StreamHandler</div><div class="line">level=INFO</div><div class="line">formatter=infoFmt</div><div class="line">args=(sys.stdout,)</div><div class="line"> </div><div class="line">[handler_errorHandler]</div><div class="line">class=logging.handlers.TimedRotatingFileHandler</div><div class="line">level=ERROR</div><div class="line">formatter=errorFmt</div><div class="line"># When computing the next rollover time for the first time (when the handler is created),</div><div class="line"># the last modification time of an existing log file, or else the current time,</div><div class="line"># is used to compute when the next rotation will occur.</div><div class="line"># 这个功能太鸡肋了，是从handler被创建的时间算起，不能按自然时间 rotation 切分，除非程序一直运行，否则这个功能会有问题</div><div class="line"># 临时解决方案参考下面的链接：Python 多进程日志记录</div><div class="line"># http://blogread.cn/it/article/4175?f=wb2</div><div class="line">args=('C:\\Users\\june\\Desktop\\error.log', 'M', 1, 5)</div><div class="line"> </div><div class="line">#--------------------------------------------------</div><div class="line"># 日志格式</div><div class="line">#--------------------------------------------------</div><div class="line"># %(asctime)s       年-月-日 时-分-秒,毫秒 2013-04-26 20:10:43,745</div><div class="line"># %(filename)s      文件名，不含目录</div><div class="line"># %(pathname)s      目录名，完整路径</div><div class="line"># %(funcName)s      函数名</div><div class="line"># %(levelname)s     级别名</div><div class="line"># %(lineno)d        行号</div><div class="line"># %(module)s        模块名</div><div class="line"># %(message)s       消息体</div><div class="line"># %(name)s          日志模块名</div><div class="line"># %(process)d       进程id</div><div class="line"># %(processName)s   进程名</div><div class="line"># %(thread)d        线程id</div><div class="line"># %(threadName)s    线程名</div><div class="line"> </div><div class="line">[formatter_infoFmt]</div><div class="line">format=%(asctime)s %(levelname)s %(message)s</div><div class="line">datefmt=</div><div class="line">class=logging.Formatter</div><div class="line"> </div><div class="line">[formatter_errorFmt]</div><div class="line">format=%(asctime)s %(levelname)s %(message)s</div><div class="line">datefmt=</div><div class="line">class=logging.Formatter</div></pre></td></tr></table></figure>
<h1 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h1><figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">__author__ = <span class="string">'Air9'</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> logging</div><div class="line"><span class="keyword">import</span> logging.config</div><div class="line"></div><div class="line">logging.config.fileConfig(<span class="string">'main.conf'</span>)</div><div class="line">root_logger = logging.getLogger(<span class="string">'root'</span>)</div><div class="line">root_logger.debug(<span class="string">'test root logger'</span>)</div><div class="line"></div><div class="line">logger = logging.getLogger(<span class="string">'main'</span>)</div><div class="line">logger.info(<span class="string">'test main logger'</span>)</div><div class="line">logger.info(<span class="string">'start import mod'</span>)</div><div class="line"><span class="keyword">import</span> mod</div><div class="line"></div><div class="line">logger.debug(<span class="string">'test mod.testmod()'</span>)</div><div class="line">mod.testmod()</div><div class="line"></div><div class="line">root_logger.info(<span class="string">'finish test'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight"><figcaption><span>main.conf</span></figcaption><table><tr><td class="code"><pre><div class="line">[loggers]</div><div class="line">keys = root, main</div><div class="line"></div><div class="line">[handlers]</div><div class="line">keys = consoleHandler</div><div class="line"></div><div class="line">[formatters]</div><div class="line">keys = simpleFormatter</div><div class="line"></div><div class="line">[logger_root]</div><div class="line">level = DEBUG</div><div class="line">handlers = consoleHandler</div><div class="line"></div><div class="line">[logger_main]</div><div class="line">level = DEBUG</div><div class="line">handlers = consoleHandler</div><div class="line">qualname = main</div><div class="line">propagate = 0</div><div class="line"></div><div class="line">[handler_consoleHandler]</div><div class="line">class = StreamHandler</div><div class="line">level = DEBUG</div><div class="line">formatter = simpleFormatter</div><div class="line">args = (sys.stdout,)</div><div class="line"></div><div class="line">[formatter_simpleFormatter]</div><div class="line">format = %(asctime)s - %(name)s - [line:%(lineno)d] - %(levelname)s - %(message)s</div><div class="line">datefmt =</div></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>mod.py</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">__author__ = <span class="string">'Air9'</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> logging</div><div class="line"><span class="keyword">import</span> submod</div><div class="line"></div><div class="line">logger = logging.getLogger(<span class="string">'main.mod'</span>)</div><div class="line">logger.info(<span class="string">'logger main.mod'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">testmod</span><span class="params">()</span>:</span></div><div class="line">    logger.debug(<span class="string">'test mod.testmod()'</span>)</div><div class="line">    submod.testsubmod()</div></pre></td></tr></table></figure>
<figure class="highlight python"><figcaption><span>submod.py</span></figcaption><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line">__author__ = <span class="string">'Air9'</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">import</span> logging</div><div class="line"></div><div class="line">logger = logging.getLogger(<span class="string">'main.mod.submod'</span>)</div><div class="line">logger.info(<span class="string">'submod.logger'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">testsubmod</span><span class="params">()</span>:</span></div><div class="line">    logger.debug(<span class="string">'test submod.testsubmod()'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>output</span></figcaption><table><tr><td class="code"><pre><div class="line">2016-04-04 14:46:24,148 - root - [line:13] - DEBUG - test root logger</div><div class="line">2016-04-04 14:46:24,148 - main - [line:16] - INFO - test main logger</div><div class="line">2016-04-04 14:46:24,148 - main - [line:17] - INFO - start import mod</div><div class="line">2016-04-04 14:46:24,148 - main.mod.submod - [line:11] - INFO - submod.logger</div><div class="line">2016-04-04 14:46:24,148 - main.mod - [line:12] - INFO - logger main.mod</div><div class="line">2016-04-04 14:46:24,149 - main - [line:20] - DEBUG - test mod.testmod()</div><div class="line">2016-04-04 14:46:24,149 - main.mod - [line:15] - DEBUG - test mod.testmod()</div><div class="line">2016-04-04 14:46:24,149 - main.mod.submod - [line:14] - DEBUG - test submod.looger</div><div class="line">2016-04-04 14:46:24,149 - root - [line:23] - INFO - finish test</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://my.oschina.net/leejun2005/blog/126713" target="_blank" rel="external">http://my.oschina.net/leejun2005/blog/126713</a></li>
<li><a href="http://blog.chinaunix.net/uid-26000296-id-4372063.html" target="_blank" rel="external">http://blog.chinaunix.net/uid-26000296-id-4372063.html</a></li>
<li><a href="http://www.tuicool.com/articles/bmMfUfE" target="_blank" rel="external">http://www.tuicool.com/articles/bmMfUfE</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/02/Spider-01-MyThreadPool/" itemprop="url">
                  Spider-01-MyThreadPool
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-04-02T16:08:14+08:00" content="2016-04-02">
              2016-04-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/02/Spider-01-MyThreadPool/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/02/Spider-01-MyThreadPool/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="知道创宇爬虫设计第一天：threadpool"><a href="#知道创宇爬虫设计第一天：threadpool" class="headerlink" title="知道创宇爬虫设计第一天：threadpool"></a>知道创宇爬虫设计第一天：threadpool</h1><p>题目要求自己实现线程池，研究了好几篇博客之后，大致提取出几个要点：</p>
<ul>
<li>使用默认的<code>Thread()</code>创建线程时，通常都是直接绑定一个具体的<code>func</code><br>但若使用线程池，初始化的线程数在有些时候可能会多于任务数<br>因此，在自定义<code>MyThread()</code>时，采用先绑定整个任务队列，然后逐条取出任务<code>func</code>执行的方式   </li>
<li>使用<code>MyThreadPool</code>提前创建所需数目的线程，再分配给具体任务<code>func</code></li>
<li>自定义<code>MyThread()</code>中需设置<code>self.daemon = True</code>，否则完成所有任务后仍不会推出</li>
<li><code>Queue()</code>提供了两个非常好用的方法<ul>
<li><code>task_done()</code>一条任务完成时通知整个队列，空闲下来的线程就可以被分配新任务</li>
<li><code>join()</code>在所有任务执行完成之前阻塞主线程</li>
</ul>
</li>
</ul>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</div><div class="line"><span class="keyword">from</span> Queue <span class="keyword">import</span> Queue</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThreadPool</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_threads=<span class="number">20</span>)</span>:</span></div><div class="line">        self.tasks = Queue(num_threads)</div><div class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(num_threads):</div><div class="line">            <span class="comment"># Init the pool with the number of num_threads</span></div><div class="line">            MyThread(self.tasks)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_task</span><span class="params">(self, func, *args, **kwargs)</span>:</span></div><div class="line">        self.tasks.put((func, args, kwargs))</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait_completion</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="comment"># Blocks until all items in the queue have been gotten and processed.</span></div><div class="line">        self.tasks.join()</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(Thread)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, tasks)</span>:</span></div><div class="line">        Thread.__init__(self)</div><div class="line">        self.tasks = tasks</div><div class="line">        <span class="comment"># This must be set before start() is called. The entire Python program</span></div><div class="line">        <span class="comment"># exits when no alive non-daemon threads are left.</span></div><div class="line">        self.daemon = <span class="keyword">True</span></div><div class="line">        self.start()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            <span class="comment"># Block until an item is available.</span></div><div class="line">            func, args, kwargs = self.tasks.get()</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                func(*args, **kwargs)</div><div class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                <span class="keyword">print</span> e</div><div class="line">            <span class="comment"># Tells the queue that the processing on the task is complete.</span></div><div class="line">            self.tasks.task_done()</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="string">''' test task '''</span></div><div class="line">    <span class="keyword">from</span> time <span class="keyword">import</span> sleep</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nap</span><span class="params">(sec)</span>:</span></div><div class="line">        sleep(sec)</div><div class="line">        <span class="keyword">print</span> <span class="string">'Had a %ds nap...'</span> % sec</div><div class="line"></div><div class="line">    tp = MyThreadPool(<span class="number">5</span>)</div><div class="line">    nap_time = [i <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">11</span>)]</div><div class="line">    <span class="keyword">for</span> i, t <span class="keyword">in</span> enumerate(nap_time, <span class="number">1</span>):</div><div class="line">        <span class="keyword">print</span> <span class="string">'Worker No.%d needs a %ds nap.'</span> % (i, t)</div><div class="line">        tp.add_task(nap, t)</div><div class="line"></div><div class="line">    tp.wait_completion()</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="http://www.the5fire.com/python-thread-pool.html" target="_blank" rel="external">python线程池</a>   </li>
<li><a href="http://github.howie.wang/2016/01/07/python-threading/" target="_blank" rel="external">【Howie玩python】-多线程从0到1到澡堂子洗澡</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/10/capstone/" itemprop="url">
                  ropgadget capstone
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-10T15:41:52+08:00" content="2016-03-10">
              2016-03-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/rop/" itemprop="url" rel="index">
                    <span itemprop="name">rop</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/10/capstone/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/10/capstone/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="import-error"><a href="#import-error" class="headerlink" title="import error"></a>import error</h1><p><a href="https://github.com/aquynh/capstone" target="_blank" rel="external">capstone</a>是一个著名的反汇编框架<br><a href="https://github.com/JonathanSalwan/ROPgadget" target="_blank" rel="external">ropgadget</a>会用到</p>
<p>但是每次<code>pip install ropgadget</code>之后都会报错<br><code>import error:ERROR: fail to load the dynamic library.</code></p>
<blockquote>
<p>2016.5.10 补充：ropgadget 里的依赖的 capstone 版本为2.1，而目前最新版本为3.0.4，pip更新 ropgadget 后会降级。。。需<code>pip install -U capstone</code></p>
</blockquote>
<p>原因在于所需的动态库文件libcapstone.dylib没有位于capstone主目录<br>所以找到libcapstone.dylib并拷贝一个就可以了</p>
<p>有两种方法</p>
<h2 id="sudo-find-name-‘libcapstone-’"><a href="#sudo-find-name-‘libcapstone-’" class="headerlink" title="sudo find / -name ‘libcapstone.*’"></a>sudo find / -name ‘libcapstone.*’</h2><p>原来作者把动态库写在了这么一个奇葩的地址<br><code>/usr/local/lib/python2.7/site-packages/usr/local/Cellar/python/2.7.11/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/capstone/libcapstone.dylib</code><br>大概是写掉了一个<code>/</code>吧，参考 <a href="https://github.com/aquynh/capstone/pull/406" target="_blank" rel="external">https://github.com/aquynh/capstone/pull/406</a></p>
<h2 id="pip-uninstall-capstone"><a href="#pip-uninstall-capstone" class="headerlink" title="pip uninstall capstone"></a>pip uninstall capstone</h2><p>这个方法略显鸡贼，但更快一点<br>可以发现列出了所有与capstone相关的文件<br>其中最后一个就是要找的libcapstone.dylib</p>
<h1 id="then"><a href="#then" class="headerlink" title="then"></a>then</h1><figure class="highlight awk"><table><tr><td class="code"><pre><div class="line">$ cp <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>python2.<span class="number">7</span><span class="regexp">/site-packages/u</span>sr<span class="regexp">/local/</span>Cellar<span class="regexp">/python/</span><span class="number">2.7</span>.<span class="number">11</span><span class="regexp">/Frameworks/</span>Python.framework<span class="regexp">/Versions/</span><span class="number">2.7</span><span class="regexp">/lib/</span>python2.<span class="number">7</span><span class="regexp">/site-packages/</span>capstone<span class="regexp">/libcapstone.dylib /u</span>sr<span class="regexp">/local/</span>lib<span class="regexp">/python2.7/</span>site-packages<span class="regexp">/capstone/</span>libcapstone.dylib</div><div class="line">$ ropgadget</div><div class="line">Need a binary filename (--binary<span class="regexp">/--console or --help)</span></div></pre></td></tr></table></figure>
<p>已经可以正常使用了</p>
<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>在kali rolling里试了一下<br>第二种方法行不通<br>只能用find<br>可以找到一个<code>/usr/lib/libcapstone.so.3</code><br>然后<br><code>cp /usr/lib/libcapstone.so.3 /usr/local/lib/python2.7/dist-packages/capstone/libcapstone.dylib</code><br>解决</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/09/hexo-scripts/" itemprop="url">
                  hexo-scripts
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-09T21:00:31+08:00" content="2016-03-09">
              2016-03-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/scripts/" itemprop="url" rel="index">
                    <span itemprop="name">scripts</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/09/hexo-scripts/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/09/hexo-scripts/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>偷师自<a href="http://www.xuxu1988.com/2015/05/16/config-my-hexo/" target="_blank" rel="external">http://www.xuxu1988.com/2015/05/16/config-my-hexo/</a></p>
<h1 id="commit-sh-COMMIT-LOG"><a href="#commit-sh-COMMIT-LOG" class="headerlink" title="./commit.sh COMMIT_LOG"></a>./commit.sh COMMIT_LOG</h1><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line">commit_log=<span class="variable">$@</span></div><div class="line"></div><div class="line">hexo g</div><div class="line"></div><div class="line"><span class="built_in">echo</span></div><div class="line">hexo d</div><div class="line"></div><div class="line"><span class="built_in">echo</span></div><div class="line">git add .</div><div class="line"></div><div class="line"><span class="built_in">echo</span></div><div class="line">git commit -m <span class="variable">$commit_log</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span></div><div class="line">git push origin hexo:hexo</div></pre></td></tr></table></figure>
<h1 id="edit-sh-FILENAME"><a href="#edit-sh-FILENAME" class="headerlink" title="./edit.sh FILENAME"></a>./edit.sh FILENAME</h1><figure class="highlight sh"><table><tr><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line">filename=<span class="variable">$@</span></div><div class="line">file=./<span class="built_in">source</span>/_posts/<span class="variable">$filename</span>.md</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ ! <span class="_">-e</span> <span class="string">"<span class="variable">$file</span>"</span> ]   <span class="comment"># NOT '$file'</span></div><div class="line"><span class="keyword">then</span> </div><div class="line">    hexo new <span class="variable">$filename</span></div><div class="line"><span class="keyword">fi</span> </div><div class="line"></div><div class="line">open <span class="_">-a</span> /Applications/MacDown.app <span class="variable">$file</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/09/hexo-github/" itemprop="url">
                  hexo github
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-09T19:08:03+08:00" content="2016-03-09">
              2016-03-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/hexo/" itemprop="url" rel="index">
                    <span itemprop="name">hexo</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/09/hexo-github/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/09/hexo-github/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hexo-amp-github"><a href="#hexo-amp-github" class="headerlink" title="hexo &amp; github"></a>hexo &amp; github</h1><p>一开始没有搞懂<code>.deploy_git</code>和<code>.git</code>的区别<br>后来发现<code>hexo deploy</code>到github上的内容只有纯粹的网页<br>才大致明白了hexo的工作流程</p>
<p>首先<br>hexo并没有生成页面文件<br>项目目录中除了配置文件以外就只有<code>hex new</code>出来的一些<code>.md</code>而已<br><code>hexo generate</code>之后才会在<code>public</code>目录下生成一系列html，css等页面文件   </p>
<p><code>hexo deploy</code>之后<br>hexo才会将所有页面文件push到项目的<code>master</code>分支(在<code>/_config.yml</code>中指定)上<br>网站因而得以运作   </p>
<p>但是这样一来<br>只有页面文件被放到了远程库<br>为了将配置文件和<code>.md</code>也放到Github<br>可以新建一个<code>hexo</code>分支来存放</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><div class="line"><span class="symbol">git</span> checkout -<span class="keyword">b </span>hexo</div><div class="line"><span class="symbol">git</span> <span class="keyword">push </span>origin hexo:hexo</div></pre></td></tr></table></figure>
<p>这样一来<br>对hexo所做的修改也可以托管在Github上了</p>
<p>以后只需在<code>hexo g</code>生成页面后<br>先用<code>hexo d</code>发布到网站（即<code>master</code>分支）<br>然后<code>add</code>-<code>commit</code>-<code>push</code>所有改动到<code>hexo</code>分支   </p>
<h1 id="push-conflict"><a href="#push-conflict" class="headerlink" title="push conflict"></a>push conflict</h1><p>不过在实际的第二次push时<br>出现了冲突</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">$ git push origin hexo:hexo</div><div class="line">To git@github<span class="selector-class">.com</span>:answerrrrrrrrr/answerrrrrrrrr<span class="selector-class">.github</span><span class="selector-class">.com</span><span class="selector-class">.git</span></div><div class="line"> ! [rejected]        hexo -&gt; hexo (non-fast-forward)</div><div class="line">error: failed to push some refs to <span class="string">'git@github.com:answerrrrrrrrr/answerrrrrrrrr.github.com.git'</span></div><div class="line">hint: Updates were rejected because the tip of your current branch is behind</div><div class="line">hint: its remote counterpart. Integrate the remote changes (e<span class="selector-class">.g</span>.</div><div class="line">hint: <span class="string">'git pull ...'</span>) before pushing again.</div><div class="line">hint: See the <span class="string">'Note about fast-forwards'</span> <span class="keyword">in</span> <span class="string">'git push --help'</span> <span class="keyword">for</span> <span class="selector-tag">details</span>.</div></pre></td></tr></table></figure>
<p>参考<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/0013760174128707b935b0be6fc4fc6ace66c4f15618f8d000" target="_blank" rel="external">廖雪峰的文章</a>得以解决</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">$ git pull</div><div class="line">There is no tracking information for the current branch.</div><div class="line">Please specify which branch you want to <span class="keyword">merge</span> with.</div><div class="line">See git-pull(<span class="number">1</span>) <span class="keyword">for</span> details</div><div class="line"></div><div class="line">    git pull &lt;remote&gt; &lt;branch&gt;</div><div class="line"></div><div class="line"><span class="keyword">If</span> you wish <span class="keyword">to</span> <span class="keyword">set</span> <span class="keyword">tracking</span> information <span class="keyword">for</span> this branch you can <span class="keyword">do</span> so <span class="keyword">with</span>:</div><div class="line"></div><div class="line">    git branch <span class="comment">--set-upstream-to=origin/&lt;branch&gt; hexo</span></div><div class="line"></div><div class="line">$ git branch <span class="comment">--set-upstream hexo origin/hexo</span></div><div class="line">The <span class="comment">--set-upstream flag is deprecated and will be removed. Consider using --track or --set-upstream-to</span></div><div class="line">Branch hexo <span class="keyword">set</span> up <span class="keyword">to</span> track remote branch hexo <span class="keyword">from</span> origin.</div><div class="line"></div><div class="line">$ git pull</div><div class="line"><span class="keyword">Auto</span>-merging index.html</div><div class="line">CONFLICT (<span class="keyword">add</span>/<span class="keyword">add</span>): <span class="keyword">Merge</span> conflict <span class="keyword">in</span> index.html</div><div class="line"><span class="keyword">Automatic</span> <span class="keyword">merge</span> <span class="keyword">failed</span>; fix conflicts and then <span class="keyword">commit</span> the result.</div><div class="line"></div><div class="line">$ git <span class="keyword">status</span></div><div class="line"><span class="keyword">On</span> branch hexo</div><div class="line">Your branch <span class="keyword">and</span> <span class="string">'origin/hexo'</span> have diverged,</div><div class="line"><span class="keyword">and</span> have <span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span> different <span class="keyword">commit</span> <span class="keyword">each</span>, respectively.</div><div class="line">  (<span class="keyword">use</span> <span class="string">"git pull"</span> <span class="keyword">to</span> <span class="keyword">merge</span> the remote branch <span class="keyword">into</span> yours)</div><div class="line">You have unmerged paths.</div><div class="line">  (fix conflicts <span class="keyword">and</span> run <span class="string">"git commit"</span>)</div><div class="line"></div><div class="line">Unmerged paths:</div><div class="line">  (<span class="keyword">use</span> <span class="string">"git add &lt;file&gt;..."</span> <span class="keyword">to</span> mark resolution)</div><div class="line"></div><div class="line">	<span class="keyword">both</span> added:      index.html</div><div class="line"></div><div class="line"><span class="keyword">no</span> changes added <span class="keyword">to</span> <span class="keyword">commit</span> (<span class="keyword">use</span> <span class="string">"git add"</span> <span class="keyword">and</span>/<span class="keyword">or</span> <span class="string">"git commit -a"</span>)</div><div class="line"></div><div class="line">$ subl index.html</div><div class="line">$ git <span class="keyword">add</span> .</div><div class="line">$ git <span class="keyword">commit</span> -m <span class="string">'index'</span></div><div class="line">	[hexo b7ed9be] <span class="keyword">index</span></div><div class="line">$ git push origin hexo:hexo</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/09/10-11-privoxy/" itemprop="url">
                  10.11 privoxy [Errno 61] Connection refused
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-09T15:33:31+08:00" content="2016-03-09">
              2016-03-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/09/10-11-privoxy/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/09/10-11-privoxy/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自从更新10.11以来<br>之前用scrapy写的一个小爬虫就用不成了<br>总是报错<code>[Errno 61] Connection refused</code><br>但是因为不经常用也就没怎么上心<br>搜了一下sof<br>以为是网站做了防爬虫处理<br>但是折腾未果就去忙正经事了   </p>
<p>结果今天挂着代理<code>pip list --outdated</code>的时候<br>居然报了同样的<code>[Errno 61] Connection refused</code><br>才意识到可能是代理的问题</p>
<p>然而Shadowsocks一直使用正常<br>那问题就只可能出在Privoxy上了   </p>
<p>果然<code>lsof -i:8118</code>之后<br>发觉Privoxy居然没有绑在8118端口上<br>难怪会「Connection refused」。。。</p>
<p>Google之后<br><a href="http://www.andrewwatters.com/privoxy/" target="_blank" rel="external">这里</a>提到更新10.11需要重装Privoxy<br>那就重装吧。。。<br>在<a href="https://sourceforge.net/projects/ijbswa/files/" target="_blank" rel="external">SourceForge</a>下载最新版<br>然后按以往一样<br><code>sudo vim /usr/local/etc/privoxy/config</code><br>修改如下两行<br><code>listen-address  127.0.0.1:8118</code><br><code>forward-socks5t   /               127.0.0.1:1080 .</code><br>再启动Privoxy<br><code>sudo /Applications/Privoxy/startPrivoxy.sh</code><br>按以往经验<br>这时候应该就可以了<br>然而<code>lsof -i:8118</code>依然什么也没有   </p>
<p>在<a href="http://1992s.com/blog/share-shadowsocks-over-lan-on-mac-os-x.html" target="_blank" rel="external">这里</a>找到问题所在<br>启用修改后的配置<br><code>cd /usr/local/sbin/</code><br><code>./privoxy --no-daemon /usr/local/etc/privoxy/config</code>   </p>
<p>这时候<code>lsof -i:8118</code><br>终于见到了久违的Privoxy<br>然后爬虫也终于重生啦</p>
<p>另外<br>也是在<a href="http://1992s.com/blog/share-shadowsocks-over-lan-on-mac-os-x.html" target="_blank" rel="external">这里</a>发现可以用Privoxy来帮手机搭梯子<br>算是意外收获了~</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/09/arch-vmtools/" itemprop="url">
                  arch vmtools
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-09T15:31:22+08:00" content="2016-03-09">
              2016-03-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Archlinux/" itemprop="url" rel="index">
                    <span itemprop="name">Archlinux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/09/arch-vmtools/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/09/arch-vmtools/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://blog.csdn.net/zhxlianxin/article/details/17636933" target="_blank" rel="external">http://blog.csdn.net/zhxlianxin/article/details/17636933</a></p>
<p><code>pacman -S open-vm-tools open-vm-tools-modules</code></p>
<p><code>pacman -S gtkmm</code></p>
<p><code>cat /proc/version &gt; /etc/arch-release</code></p>
<p><code>systemctl start vmtoolsd</code></p>
<p><code>systemctl enable vmtoolsd</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/09/arch-gdb-peda-pip-ropgadget/" itemprop="url">
                  arch gdb pip ropgadget
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-09T15:28:36+08:00" content="2016-03-09">
              2016-03-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/rop/" itemprop="url" rel="index">
                    <span itemprop="name">rop</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/09/arch-gdb-peda-pip-ropgadget/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/09/arch-gdb-peda-pip-ropgadget/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="gdb-plugin-gdb-peda"><a href="#gdb-plugin-gdb-peda" class="headerlink" title="gdb plugin: gdb-peda"></a>gdb plugin: <a href="https://github.com/longld/peda" target="_blank" rel="external">gdb-peda</a></h3><p><code>sudo pacman -S gdb</code></p>
<p><code>git clone https://github.com/longld/peda.git ~/peda</code></p>
<p><code>echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit</code></p>
<h3 id="gdb-plugin-libheap"><a href="#gdb-plugin-libheap" class="headerlink" title="gdb plugin: libheap"></a>gdb plugin: <a href="https://github.com/cloudburst/libheap" target="_blank" rel="external">libheap</a></h3><p><code>curl https://raw.githubusercontent.com/answerrrrrrrrr/VRL/master/test/exploits/lib/libheap.py &gt; libheap.py</code></p>
<p><code>sudo mv libheap.py /usr/lib/python2.7</code></p>
<p><code>gdb</code></p>
<p><code>(gdb) python from libheap import *</code></p>
<p><code>(gdb) heap -h</code></p>
<h3 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h3><p><code>curl https://bootstrap.pypa.io/get-pip.py &gt; getpip.py</code></p>
<p><code>sudo python getpip.py</code></p>
<h3 id="ROPgadget"><a href="#ROPgadget" class="headerlink" title="ROPgadget"></a>ROPgadget</h3><p><code>sudo pacman -S python-capstone</code></p>
<p><code>sudo pip install ropgadget</code></p>
<p>If gets errors about capstone:</p>
<p><code>sudo pip install ropgadget --upgrade</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/09/tmux-copy2clipboard/" itemprop="url">
                  tmux copy2clipboard
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-09T15:25:31+08:00" content="2016-03-09">
              2016-03-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tmux/" itemprop="url" rel="index">
                    <span itemprop="name">tmux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/09/tmux-copy2clipboard/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/09/tmux-copy2clipboard/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://wiki.archlinux.org/index.php/Tmux#Mouse_scrolling" target="_blank" rel="external">https://wiki.archlinux.org/index.php/Tmux#Mouse_scrolling</a></p>
<h1 id="Mouse-scrolling"><a href="#Mouse-scrolling" class="headerlink" title="Mouse scrolling"></a>Mouse scrolling</h1><p><em>Note: This interferes with selection buffer copying and pasting. To copy/paste to/from the selection buffer hold the <code>shift</code> key.</em></p>
<p>If you want to scroll with your mouse wheel, ensure mode-mouse is on in .tmux.conf</p>
<pre><code>set -g mouse on
</code></pre><p>You can set scroll History with:</p>
<pre><code>set -g history-limit 30000
</code></pre><p>For mouse wheel scrolling as from tmux 2.1 try adding one or both of these to ~/.tmux.conf</p>
<pre><code>bind-key -T root WheelUpPane   if-shell -F -t = &quot;#{alternate_on}&quot; &quot;send-keys -M&quot; &quot;select-pane -t =; copy-mode -e; send-keys -M&quot;   
bind-key -T root WheelDownPane if-shell -F -t = &quot;#{alternate_on}&quot; &quot;send-keys -M&quot; &quot;select-pane -t =; send-keys -M&quot;
</code></pre><h1 id="Copy-from-tmux-to-clipboard"><a href="#Copy-from-tmux-to-clipboard" class="headerlink" title="Copy from tmux to clipboard"></a>Copy from tmux to clipboard</h1><p>Hold the <code>shift</code> key to select the text, then copy &amp; paste.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/09/powerline/" itemprop="url">
                  iTerm下配置Powerline
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-03-09T15:06:29+08:00" content="2016-03-09">
              2016-03-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/09/powerline/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/09/powerline/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Powerline"><a href="#Powerline" class="headerlink" title="Powerline"></a>Powerline</h1><p>今天指压师折腾powerline的时候也卡住了，帮他搞定之后，不禁想起以前我折腾这个的时候，网上各种教程都莫名其妙忽略了最关键的iTerm调字体部分，干脆把自己当时写的一篇笔记改一改发blog算了</p>
<p><img src="https://raw.githubusercontent.com/answerrrrrrrrr/Res/master/Blog/2015-10-03-powerline/powerline.png" width="100%" height="100%"></p>
<h2 id="For-zsh"><a href="#For-zsh" class="headerlink" title="For zsh"></a>For zsh</h2><ul>
<li><p>手动下载 <a href="https://github.com/powerline/powerline" target="_blank" rel="external">powerline</a>并解压到主目录</p>
<p>  或者 </p>
<p>  $ <code>git clone https://github.com/powerline/powerline</code>            </p>
</li>
<li><p>$ <code>vim ~/.zshrc</code></p>
</li>
</ul>
<p>在zsh配置文件里加入一行:  </p>
<pre><code>. ~/powerline-develop/powerline/bindings/zsh/powerline.zsh
</code></pre><p>然后启用新配置：</p>
<p>$ <code>source ~/.zshrc</code></p>
<ul>
<li><p>手动下载 <a href="https://github.com/powerline/fonts" target="_blank" rel="external">powerline fonts</a></p>
<p>  或者</p>
<p>  $ <code>git clone https://github.com/powerline/fonts</code></p>
</li>
<li><p>然后安装：</p>
<p>  $ <code>cd fonts</code></p>
<p>  $ <code>./install.sh</code></p>
</li>
<li><p>打开 <code>iTerm</code> - <code>Preferences</code> - <code>Profiles</code> - <code>Text</code>  </p>
<p>  将 <code>Regular Font</code> &amp; <code>Non-ASCII Font</code> 都改为带有 <code>for Powerline</code>后缀的字体</p>
<p>  我感觉看着比较舒服的是<code>Source Code Pro for Powerline</code></p>
<p>  选好的瞬间，iTerm里面的预览效果应该就已经出来了</p>
<p>  稍微有点蛋疼的是，iTerm调了透明的时候，箭头符号却不会跟着透明，看着不太顺眼</p>
</li>
</ul>
<h2 id="For-vim"><a href="#For-vim" class="headerlink" title="For vim"></a>For vim</h2><p>$ <code>vim ~/.vimrc</code></p>
<p>加入:</p>
<pre><code>set rtp+=~/powerline-develop/powerline/bindings/vim
set guifont=Monaco\ for\ Powerline:h14.5
set laststatus=2
let g:Powerline_symbols = &apos;fancy&apos;
set encoding=utf-8
set t_Co=256
set number
set fillchars+=stl:\ ,stlnc:\
set term=xterm-256color
set termencoding=utf-8
syntax enable
set background=light    
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Air9" />
          <p class="site-author-name" itemprop="name">Air9</p>
          <p class="site-description motion-element" itemprop="description">なぜベストを尽くしたのか</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">100</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Air9</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"answerrrrrrrrr"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  


</body>
</html>
