<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Answerrrrrrrrr" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="なぜベストを尽くしたのか">
<meta property="og:type" content="website">
<meta property="og:title" content="Answerrrrrrrrr">
<meta property="og:url" content="http://answerrrrrrrrr.io/index.html">
<meta property="og:site_name" content="Answerrrrrrrrr">
<meta property="og:description" content="なぜベストを尽くしたのか">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Answerrrrrrrrr">
<meta name="twitter:description" content="なぜベストを尽くしたのか">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Answerrrrrrrrr </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Answerrrrrrrrr</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/08/idapython-elf-gadget/" itemprop="url">
                  idapython-elf-gadget
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-08T11:38:29+08:00" content="2016-10-08">
              2016-10-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/idapython/" itemprop="url" rel="index">
                    <span itemprop="name">idapython</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/08/idapython-elf-gadget/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/08/idapython-elf-gadget/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h1><figure class="highlight md"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── batch.py</span><br><span class="line">├── detail</span><br><span class="line">│   ├── heap_test.txt</span><br><span class="line">│   ├── heap<span class="emphasis">_test_</span>static.txt</span><br><span class="line">│   ├── libc2.21.txt</span><br><span class="line">│   ├── ls.txt</span><br><span class="line">│   ├── mv.txt</span><br><span class="line">│   ├── stack_test.txt</span><br><span class="line">│   └── stack<span class="emphasis">_test_</span>static.txt</span><br><span class="line">├── elf</span><br><span class="line">│   ├── heap_test</span><br><span class="line">│   ├── heap<span class="emphasis">_test_</span>static</span><br><span class="line">│   ├── libc2.21</span><br><span class="line">│   ├── ls</span><br><span class="line">│   ├── mv</span><br><span class="line">│   ├── stack_test</span><br><span class="line">│   └── stack<span class="emphasis">_test_</span>static</span><br><span class="line">├── fragment</span><br><span class="line">│   ├── heap_test.txt</span><br><span class="line">│   ├── heap<span class="emphasis">_test_</span>static.txt</span><br><span class="line">│   ├── libc2.21.txt</span><br><span class="line">│   ├── ls.txt</span><br><span class="line">│   ├── mv.txt</span><br><span class="line">│   ├── stack_test.txt</span><br><span class="line">│   └── stack<span class="emphasis">_test_</span>static.txt</span><br><span class="line">├── ganalyzer.py</span><br><span class="line">├── gcollector.py</span><br><span class="line">├── gvalidator.py</span><br><span class="line">├── lib</span><br><span class="line">│   ├── <span class="strong">__init__</span>.py</span><br><span class="line">│   ├── <span class="strong">__init__</span>.pyc</span><br><span class="line">│   ├── classifier.py</span><br><span class="line">│   ├── classifier.pyc</span><br><span class="line">│   ├── extra_archinfo.py</span><br><span class="line">│   ├── extra_archinfo.pyc</span><br><span class="line">│   ├── gadget.py</span><br><span class="line">│   ├── gadget.pyc</span><br><span class="line">│   ├── utils.py</span><br><span class="line">│   ├── utils.pyc</span><br><span class="line">│   ├── validator.py</span><br><span class="line">│   └── validator.pyc</span><br><span class="line">├── pin</span><br><span class="line">│   ├── heap_test.txt</span><br><span class="line">│   ├── heap<span class="emphasis">_test_</span>static.txt</span><br><span class="line">│   ├── libc2.21.txt</span><br><span class="line">│   ├── ls.txt</span><br><span class="line">│   ├── mv.txt</span><br><span class="line">│   ├── stack_test.txt</span><br><span class="line">│   └── stack<span class="emphasis">_test_</span>static.txt</span><br><span class="line">└── result.txt</span><br><span class="line"></span><br><span class="line">5 directories, 46 files</span><br></pre></td></tr></table></figure>
<h1 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h1><p><img src="/images/idapython-elf-gadget.png" alt="img"></p>
<h1 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h1><ol>
<li>将要分析的 elf 文件放入 elf 目录</li>
<li>在主目录运行<code>python batch.py</code></li>
<li>脚本会批量使用 ida 静态分析 elf 目录内的所有 elf 文件并在完成后自动关闭 ida</li>
<li>由于版本功能限制，无法完全自动化，每个 elf 需要在弹窗时手动回车确认 2 次</li>
<li>中间结果分别保存于 fragment, detail 和 pin 目录，最终结果保存于主目录下的 result.txt</li>
</ol>
<h1 id="主要模块"><a href="#主要模块" class="headerlink" title="主要模块"></a>主要模块</h1><h2 id="gcollector-py"><a href="#gcollector-py" class="headerlink" title="gcollector.py"></a>gcollector.py</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>找到所有间接跳转（IBR)，再按 IBR 所在地址回溯，直到上一条跳转指令为止，输出其间所有可能构成 gadget 的指令片段，按不同文件名保存到 fragment 目录 </p>
<h3 id="例如"><a href="#例如" class="headerlink" title="例如"></a>例如</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">&gt; length: 1</span><br><span class="line">|-- .fini:80485B7	retn</span><br><span class="line">c3</span><br><span class="line">----------------------------------------</span><br><span class="line">&gt; length: 2</span><br><span class="line">|-- .fini:80485B6	pop     ebx</span><br><span class="line">|-- .fini:80485B7	retn</span><br><span class="line">5bc3</span><br><span class="line">----------------------------------------</span><br><span class="line">&gt; length: 3</span><br><span class="line">|-- .fini:80485B3	add     esp, 8</span><br><span class="line">|-- .fini:80485B6	pop     ebx</span><br><span class="line">|-- .fini:80485B7	retn</span><br><span class="line">83c4085bc3</span><br><span class="line">----------------------------------------</span><br><span class="line">&gt; length: 4</span><br><span class="line">|-- .fini:80485AD	add     ebx, 1217h</span><br><span class="line">|-- .fini:80485B3	add     esp, 8</span><br><span class="line">|-- .fini:80485B6	pop     ebx</span><br><span class="line">|-- .fini:80485B7	retn</span><br><span class="line">81c31712000083c4085bc3</span><br></pre></td></tr></table></figure>
<p>回溯到第 5 条指令时为另一条跳转指令，所以以 <code>80485B7    retn</code>为结尾所有可能为 gadget 的指令片段一共只有 4 种</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li>利用 ida-python 提供的 api <code>Segments()</code>获得所有段起始地址，<code>SegEnd()</code>获取段结束地址</li>
<li>根据对应段的起止地址，利用<code>Heads(start, end)</code>得到段内所有指令的起始地址</li>
<li>利用<code>disasm(head)</code>函数获得指令的机器码和汇编代码</li>
<li>通过正则表达式和机器码判断指令是否为<code>间接跳转指令</code>并按如上目标格式保存，同时加上<code>call-preceded</code>和<code>syscall</code>等标记</li>
<li>对总指令数等数据进行统计，同时利用<code>Functions()</code>收集所有函数入口</li>
</ol>
<h2 id="gvalidator-py"><a href="#gvalidator-py" class="headerlink" title="gvalidator.py"></a>gvalidator.py</h2><h3 id="目标-1"><a href="#目标-1" class="headerlink" title="目标"></a>目标</h3><p>以每个间接跳转为单位，对所有以该间接跳转为结尾的指令片段进行判断：</p>
<ol>
<li>是否存在 functional gadget， 最大长度多少</li>
<li>是否存在 nop gadget， 最大长度多少</li>
<li>是否为 call-preceded gadget</li>
</ol>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><ol>
<li>遍历 fragment 目录中所有 txt 文件并依次进行逐行读取，根据<code>+&gt;|-*</code>等预设标记判断该行内容类型，然后收集对应长度的指令片段、片段内部遭到修改的寄存器</li>
<li>读取到整个指令片段的机器码时，利用 Q 的 api <code>classifier.GadgetClassifier()</code>判断片段是否为 functional gadget，并统计相关数据</li>
<li>若非 functional gadget，根据可容忍的最大寄存器修改数量判断可否归为 nop gadget，并统计相关数据</li>
<li>按文件名保存所有统计数据到 detail 目录</li>
<li>另外按照 pin 动态分析所需的输入数据格式将对应部分数据保存到 pin 目录</li>
</ol>
<h2 id="ganalyzer-py"><a href="#ganalyzer-py" class="headerlink" title="ganalyzer.py"></a>ganalyzer.py</h2><h3 id="目标-2"><a href="#目标-2" class="headerlink" title="目标"></a>目标</h3><p>将 detail 目录中所有统计数据汇总到 result.txt 中</p>
<h3 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line">heap_test, heap_test_static, libc2, ls, mv, stack_test, stack_test_static</span><br><span class="line">+ Files: <span class="number">7</span></span><br><span class="line"></span><br><span class="line">+ [AVG]</span><br><span class="line">|-- Functions: <span class="number">794.00</span></span><br><span class="line">|-- Instructions: <span class="number">86870.29</span></span><br><span class="line">|-- Branch instructions: <span class="number">17118.00</span></span><br><span class="line">|-- Indirect branch instructions: <span class="number">1609.29</span></span><br><span class="line">    |-- ret: <span class="number">1211.43</span> (<span class="number">9</span> ~ <span class="number">5587</span>)</span><br><span class="line">    |-- jmp: <span class="number">88.00</span> (<span class="number">1</span> ~ <span class="number">408</span>)</span><br><span class="line">    |-- call: <span class="number">284.43</span> (<span class="number">4</span> ~ <span class="number">1300</span>)</span><br><span class="line">    |-- system call: <span class="number">90.57</span> (<span class="number">0</span> ~ <span class="number">462</span>)</span><br><span class="line">    |-- call preceded: <span class="number">284.43</span> (<span class="number">4</span> ~ <span class="number">1300</span>)</span><br><span class="line">|-- Functional gadgets: <span class="number">6145.29</span></span><br><span class="line">    |-- length: <span class="number">4.15</span> (<span class="number">0</span> ~ <span class="number">48</span>)</span><br><span class="line">|-- Nop gadgets: <span class="number">3634.14</span></span><br><span class="line">    |-- length: <span class="number">2.07</span> (<span class="number">0</span> ~ <span class="number">71</span>)</span><br><span class="line">|-- Normal code fragments: <span class="number">924.57</span></span><br><span class="line">    |-- length: <span class="number">9.01</span> (<span class="number">0</span> ~ <span class="number">80</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/27/ionic-popover/" itemprop="url">
                  ionic 使用 popover 时的一点小问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-27T16:52:04+08:00" content="2016-09-27">
              2016-09-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ionic/" itemprop="url" rel="index">
                    <span itemprop="name">ionic</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/27/ionic-popover/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/27/ionic-popover/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用 ionic 附带的 ngResource 时需要在 index.html 中加上</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"lib/ionic/js/angular/angular-resource.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>否则会报错</p>
<p>另外，<a href="http://ionicframework.com/docs/api/service/$ionicPopover/" target="_blank" rel="external">官方文档</a>中关于使用<code>popover</code>独立 html 模板的格式有点小问题：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">"my-popover.html"</span> <span class="attr">type</span>=<span class="string">"text/ng-template"</span>&gt;</span><span class="handlebars"><span class="xml"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ion-popover-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ion-header-bar</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>My Popover Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ion-header-bar</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ion-content</span>&gt;</span></span><br><span class="line">      Hello!</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ion-popover-view</span>&gt;</span></span><br><span class="line"></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>需改为</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ion-popover-view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ion-header-bar</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>My Popover Title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ion-header-bar</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ion-content</span>&gt;</span></span><br><span class="line">    Hello!qwew</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ion-popover-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>否则会无法找到对应 template 而产生<code>Error: popoverEle[0] is undefined</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/code-smell/" itemprop="url">
                  Code Smell
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-25T16:44:03+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Code/" itemprop="url" rel="index">
                    <span itemprop="name">Code</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/25/code-smell/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/25/code-smell/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自：<a href="http://www.nowamagic.net/librarys/veda/detail/2053" target="_blank" rel="external">http://www.nowamagic.net/librarys/veda/detail/2053</a></p>
<p>Code Smell中文译名一般为“代码异味”，或“代码味道”，它是提示代码中某个地方存在错误的一个暗示，开发人员可以通过这种smell（异味）在代码中追捕到问题。</p>
<p>在计算机编程社区中，code smell代表了任何标志着事物变坏的征兆。它常常标志代码应该被refactored或者全部的设计都应该被reviewed。这个短语出现在 WardsWiki上，它是被Kent Beck杜撰出来的。在refactoring兴起之后，这个短语的使用率骤增。</p>
<p>判断是否存在code smell经常是主观判断，并且随着语言、开发者、开发理论的不同而存在差异。</p>
<p>经验丰富和知识渊博的开发人员通过对优秀设计有一种“感觉”，他们已经达到一种称之为“无意识能力 （UnconsciousCompetence）”的状态。也就是说，他们无需思考，只要通过查看代码或一段设计就可以立马对这个项目的代码质量有一种 “感觉”，能够对代码设计的优劣有一个大致的判断。</p>
<p>但大家需要注意，code smell只是一种“暗示”，而非一种“确定”。将某些事物称之为“code smell”并未是一种攻击，它只是一种提示：开发人员需要对项目设计进行更进一步的查看。因此，code smell更多是“直觉的，本能的”。</p>
<p>code smell一般包括：</p>
<ol>
<li><p>Duplicated Code。代码重复几乎是最常见的异味了。他也是Refactoring 的主要目标之一。代码重复往往来自于copy-and-paste 的编程风格。与他相对应OAOO 是一个好系统的重要标志。</p>
</li>
<li><p>Long method。它是传统结构化的“遗毒”。一个方法应当具有自我独立的意图，不要把几个意图放在一起，特别注意大类和长方法。</p>
</li>
<li><p>Large Class。大类就是你把太多的责任交给了一个类。这里的规则是One Class One。</p>
</li>
<li><p>Divergent Change。一个类里面的内容变化率不同。某些状态一个小时变一次，某些则几个月一年才变一次；某些状态因为这方面的原因发生变化，而另一些则因为其他方面的原因变一 次。面向对象的抽象就是把相对不变的和相对变化相隔离。把问题变化的一方面和另一方面相隔离。这使得这些相对不变的可以重用。问题变化的每个方面都可以单 独重用。这种相异变化的共存使得重用非常困难。</p>
</li>
<li><p>Shotgun Surgery。这正好和上面相反。对系统一个地方的改变涉及到其他许多地方的相关改变。这些变化率和变化内容相似的状态和行为通常应当放在同一个类中。</p>
</li>
<li><p>Feature Envy。对象的目的就是封装状态以及与这些状态紧密相关的行为。如果一个类的方法频繁用get 方法存取其他类的状态进行计算，那么你要考虑把行为移到涉及状态数目最多的那个类。</p>
</li>
<li><p>Data Clumps。某些数据通常像孩子一样成群玩耍：一起出现在很多类的成员变量中，一起出现在许多方法的参数中……，这些数据或许应该自己独立形成对象。</p>
</li>
<li><p>Primitive Obsession。面向对象的新手通常习惯使用几个原始类型的数据来表示一个概念。譬如对于范围，他们会使用两个数字。对于Money，他们会用一个浮点数来表示。因为你没 有使用对象来表达问题中存在的概念，这使得代码变的难以理解，解决问题的难度大大增加。好的习惯是扩充语言所能提供原始类型，用小对象来表示范围、金额、 转化率、邮政编码等等。</p>
</li>
<li><p>Switch Statement。基于常量的开关语句是OO 的大敌，你应当把他变为子类、state 或strategy。</p>
</li>
<li><p>Parallel Inheritance Hierarchies。并行的继承层次是shotgun surgery 的特殊情况。因为当你改变一个层次中的某一个类时，你必须同时改变另外一个层次的并行子类。</p>
</li>
<li><p>Lazy Class。一个干活不多的类。类的维护需要额外的开销，如果一个类承担了太少的责任，应当消除它。</p>
</li>
<li><p>Speculative Generality。一个类实现了从未用到的功能和通用性。通常这样的类或方法唯一的用户是test case。不要犹豫，删除它。</p>
</li>
<li><p>Temporary Field。一个对象的属性可能只在某些情况下才有意义。这样的代码将难以理解。专门建立一个对象来持有这样的孤儿属性，把只和他相关的行为移到该类。最常见的是一个特定的算法需要某些只有该算法才有用的变量。</p>
</li>
<li><p>Message Chain。消息链发生于当一个客户向一个对象要求另一个对象，然后客户又向这另一对象要求另一个对象，再向这另一个对象要求另一个对象，如此如此。这时，你需要隐藏分派。</p>
</li>
<li><p>Middle Man。对象的基本特性之一就是封装，而你经常会通过分派去实现封装。但是这一步不能走得太远，如果你发现一个类接口的一大半方法都在做分派，你可能需要移去这个中间人。</p>
</li>
<li><p>Inappropriate Intimacy。某些类相互之间太亲密，它们花费了太多的时间去砖研别人的私有部分。对人类而言，我们也许不应该太假正经，但我们应当让自己的类严格遵守禁欲主义。</p>
</li>
<li><p>Alternative Classes with Different Interfaces。做相同事情的方法有不同的函数signature，一致把它们往类层次上移，直至协议一致。</p>
</li>
<li><p>Incomplete Library Class。要建立一个好的类库非常困难。我们大量的程序工作都基于类库实现。然而，如此广泛而又相异的目标对库构建者提出了苛刻的要求。库构建者也不是万能的。有时 候我们会发现库类无法实现我们需要的功能。而直接对库类的修改有非常困难。这时候就需要用各种手段进行Refactoring。</p>
</li>
<li><p>Data Class。对象包括状态和行为。如果一个类只有状态没有行为，那么肯定有什么地方出问题了。</p>
</li>
<li><p>Refused Bequest。超类传下来很多行为和状态，而子类只是用了其中的很小一部分。这通常意味着你的类层次有问题。</p>
</li>
<li><p>Comments。经常觉得要写很多注释表示你的代码难以理解。如果这种感觉太多，表示你需要Refactoring。</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/22/mac-mongod/" itemprop="url">
                  Mac 安装 mongodb
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-22T20:35:03+08:00" content="2016-09-22">
              2016-09-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Mac/" itemprop="url" rel="index">
                    <span itemprop="name">Mac</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/22/mac-mongod/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/22/mac-mongod/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Mac 下按照<a href="https://docs.mongodb.com/manual/mongo/" target="_blank" rel="external">官网说明</a> 安装 mongodb 并配置好<code>PATH</code>后直接<code>mongo</code>会报错：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ brew <span class="keyword">install</span> mongodb</span><br><span class="line">...</span><br><span class="line">$ <span class="keyword">export</span> <span class="keyword">PATH</span>=$<span class="keyword">PATH</span>:/usr/<span class="keyword">local</span>/Cellar/mongodb/<span class="number">3.2</span><span class="number">.9</span>/<span class="keyword">bin</span></span><br><span class="line">$ mongo</span><br><span class="line">MongoDB shell <span class="keyword">version</span>: <span class="number">3.2</span><span class="number">.9</span></span><br><span class="line">connecting <span class="keyword">to</span>: <span class="keyword">test</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span>T20:<span class="number">15</span>:<span class="number">48.787</span>+<span class="number">0800</span> W NETWORK  [thread1] <span class="keyword">Failed</span> <span class="keyword">to</span> <span class="keyword">connect</span> <span class="keyword">to</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">27017</span>, reason: errno:<span class="number">61</span> <span class="keyword">Connection</span> refused</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span>T20:<span class="number">15</span>:<span class="number">48.789</span>+<span class="number">0800</span> E <span class="keyword">QUERY</span>    [thread1] <span class="keyword">Error</span>: couldn<span class="string">'t connect to server 127.0.0.1:27017, connection attempt failed :</span><br><span class="line">connect@src/mongo/shell/mongo.js:229:14</span><br><span class="line">@(connect):1:6</span><br><span class="line"></span><br><span class="line">exception: connect failed</span></span><br></pre></td></tr></table></figure>
<p>好在 <a href="http://stackoverflow.com/questions/12831939/couldnt-connect-to-server-127-0-0-127017/17220732#17220732" target="_blank" rel="external">Stackoverflow</a> 一个答案提到，是因为没有启动 mongodb service:</p>
<blockquote>
<p>Did you run mongod before running mongo?</p>
<p>I followed installation instructions for mongodb from <a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-os-x/" target="_blank" rel="external">http://docs.mongodb.org/manual/tutorial/install-mongodb-on-os-x/</a> and I had the same error as you only when I ran mongo before actually running the mongo process with mongod. I thought installing mongodb would also launch it but you need to launch it manually with mongod before you do anything else that needs mongodb.</p>
</blockquote>
<p>不过还是报错：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">$ mongod</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.094</span>+<span class="number">0800</span> I CONTROL  [initandlisten] MongoDB <span class="string">starting :</span> pid=<span class="number">75109</span> port=<span class="number">27017</span> dbpath=<span class="regexp">/data/</span>db <span class="number">64</span>-bit host=localhost</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten] db version v3<span class="number">.2</span><span class="number">.9</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten] git <span class="string">version:</span> <span class="number">22</span>ec9e93b40c85fc7cae7d56e7d6a02fd811088c</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten] OpenSSL <span class="string">version:</span> OpenSSL <span class="number">1.0</span><span class="number">.2</span>h  <span class="number">3</span> May <span class="number">2016</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten] <span class="string">allocator:</span> system</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten] <span class="string">modules:</span> none</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten] build <span class="string">environment:</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten]     <span class="string">distarch:</span> x86_64</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten]     <span class="string">target_arch:</span> x86_64</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.095</span>+<span class="number">0800</span> I CONTROL  [initandlisten] <span class="string">options:</span> &#123;&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.097</span>+<span class="number">0800</span> I -        [initandlisten] Detected data files <span class="keyword">in</span> <span class="regexp">/data/</span>db created by the <span class="string">'mmapv1'</span> storage engine, so setting the active storage engine to <span class="string">'mmapv1'</span>.</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T20:</span><span class="number">28</span>:<span class="number">37.100</span>+<span class="number">0800</span> I STORAGE  [initandlisten] exception <span class="keyword">in</span> <span class="string">initAndListen:</span> <span class="number">98</span> Unable to create<span class="regexp">/open lock file: /</span>data<span class="regexp">/db/</span>mongod.lock <span class="string">errno:</span><span class="number">13</span> Permission denied Is a mongod instance already running?, terminating</span><br><span class="line">2016-09-22T20:<span class="number">28</span>:<span class="number">37.100</span>+<span class="number">0800</span> I CONTROL  [initandlisten] <span class="string">dbexit:</span>  <span class="string">rc:</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>
<p>看见<code>lock file</code>习惯性想去删掉，结果依然不行</p>
<p>最后还是在 <a href="http://stackoverflow.com/questions/15229412/unable-to-create-open-lock-file-data-mongod-lock-errno13-permission-denied/22623543#22623543" target="_blank" rel="external">Stackoverflow</a> 找到解决方法：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">$ sudo chown -R $USER <span class="regexp">/data/</span>db</span><br><span class="line">$ mongod</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten] MongoDB <span class="string">starting :</span> pid=<span class="number">75729</span> port=<span class="number">27017</span> dbpath=<span class="regexp">/data/</span>db <span class="number">64</span>-bit host=localhost</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten] db version v3<span class="number">.2</span><span class="number">.9</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten] git <span class="string">version:</span> <span class="number">22</span>ec9e93b40c85fc7cae7d56e7d6a02fd811088c</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten] OpenSSL <span class="string">version:</span> OpenSSL <span class="number">1.0</span><span class="number">.2</span>h  <span class="number">3</span> May <span class="number">2016</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten] <span class="string">allocator:</span> system</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten] <span class="string">modules:</span> none</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten] build <span class="string">environment:</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten]     <span class="string">distarch:</span> x86_64</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.066</span>+<span class="number">0800</span> I CONTROL  [initandlisten]     <span class="string">target_arch:</span> x86_64</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.067</span>+<span class="number">0800</span> I CONTROL  [initandlisten] <span class="string">options:</span> &#123;&#125;</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.069</span>+<span class="number">0800</span> I -        [initandlisten] Detected data files <span class="keyword">in</span> <span class="regexp">/data/</span>db created by the <span class="string">'mmapv1'</span> storage engine, so setting the active storage engine to <span class="string">'mmapv1'</span>.</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.096</span>+<span class="number">0800</span> I JOURNAL  [initandlisten] journal dir=<span class="regexp">/data/</span>db/journal</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.096</span>+<span class="number">0800</span> I JOURNAL  [initandlisten] <span class="string">recover :</span> no journal files present, no recovery needed</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.112</span>+<span class="number">0800</span> I JOURNAL  [durability] Durability thread started</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.112</span>+<span class="number">0800</span> I JOURNAL  [journal writer] Journal writer thread started</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.438</span>+<span class="number">0800</span> I FTDC     [initandlisten] Initializing full-time diagnostic data capture with directory <span class="string">'/data/db/diagnostic.data'</span></span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.438</span>+<span class="number">0800</span> I NETWORK  [HostnameCanonicalizationWorker] Starting hostname canonicalization worker</span><br><span class="line"><span class="number">2016</span><span class="number">-09</span><span class="number">-22</span><span class="string">T21:</span><span class="number">08</span>:<span class="number">07.439</span>+<span class="number">0800</span> I NETWORK  [initandlisten] waiting <span class="keyword">for</span> connections on port <span class="number">27017</span></span><br></pre></td></tr></table></figure>
<p>开启<code>mongod</code>后再<code>mongo</code>就可以了</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">$ mongo</span><br><span class="line">MongoDB <span class="built_in">shell</span> <span class="built_in">version</span>: <span class="number">3.2</span><span class="number">.9</span></span><br><span class="line">connecting <span class="built_in">to</span>: test</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>感觉 mongodb 的官方文档有点掉链子啊…</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/20/idapython-commandline/" itemprop="url">
                  命令行调用 idapython 脚本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-20T10:40:41+08:00" content="2016-09-20">
              2016-09-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ida/" itemprop="url" rel="index">
                    <span itemprop="name">ida</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/20/idapython-commandline/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/20/idapython-commandline/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol>
<li><p>安装 Python 2.7</p>
</li>
<li><p>下载 <a href="https://github.com/idapython/bin/raw/master/idapython-6.9.0-python2.7-mac.zip" target="_blank" rel="external">https://github.com/idapython/bin/raw/master/idapython-6.9.0-python2.7-mac.zip</a> 并解压</p>
</li>
<li><p>将 Python 内的所有内容复制到 IDA 根目录的 Python 内（没有就新建）</p>
</li>
<li><p>将 Plugins 内的所有内容复制到 IDA 根目录的 Plugins 内</p>
</li>
<li><p>将 python.cfg 复制到 IDA 根目录的 cfg 内</p>
</li>
<li><p>重启 IDA，File 菜单下面会有 Python Command 选项，而且 Script files 选项中可以选择 py 文件</p>
</li>
</ol>
<p>python 目录中的四个文件：</p>
<ul>
<li>init.py 是初始的基础文件</li>
<li>idaapi.py 中导入了 _idaapi 模块，这个以下划线开始的 idaapi 模块就是对 IDA API 的低层封装，idaapi.py 则是作为调用 IDA API 的用户层</li>
<li>idautils.py 提供了一些高级功能的函数</li>
<li>idc.py 则是对 IDA 内置的 IDC 脚本语言的兼容</li>
</ul>
<h1 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h1><p>调用 idapython 脚本时总是要鼠标点来点去很不方便，在官网找了找 </p>
<p><a href="https://www.hex-rays.com/products/ida/support/idadoc/417.shtml" target="_blank" rel="external">https://www.hex-rays.com/products/ida/support/idadoc/417.shtml</a></p>
<p>该页面提供了命令行使用 ida 时的可用参数，比较常用的有：</p>
<p>-A 让 ida 自动运行，不需要人工干预。也就是在处理的过程中不会弹出交互窗口，但是如果从来没有使用过 ida 那么许可协议的窗口无论你是否使用这个参数都将会显示。</p>
<p>-c 参数会删除所有与参数中指定的文件相关的数据库，并且生成一个新的数据库。</p>
<p>-S 参数用于指定 ida 在分析完数据之后执行的 idc 脚本，<strong>注意：该选项和参数之间没有空格</strong>，并且搜索目录为 ida 目录下的 idc 目录。</p>
<p>-B 参数指定批量模式，等效于-A –c  –Sanylysis.idc.在分析完成后会自动生成相关的数据库和 asm 代码。并且在最后关闭 ida，以保存新的数据库。</p>
<p><em><a href="http://www.h4ck.org.cn/2012/03/ida-batch-mode/" target="_blank" rel="external">这篇文章</a><sup>2</sup>比较详细地讲解了批量模式的用法</em> </p>
<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><figure class="highlight py"><figcaption><span>test.py</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> idautils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line">idc.Wait()	<span class="comment"># idaapi.autoWait()</span></span><br><span class="line"></span><br><span class="line">ea = BeginEA()</span><br><span class="line">dll_functions = []</span><br><span class="line"></span><br><span class="line">fp = open(<span class="string">"fun_output.txt"</span>, <span class="string">"w"</span>)</span><br><span class="line">fp.write(<span class="string">"check"</span>)</span><br><span class="line"><span class="keyword">for</span> funcea <span class="keyword">in</span> Functions(SegStart(ea), SegEnd(ea)):</span><br><span class="line">    functionName = GetFunctionName(funcea)</span><br><span class="line">    dll_functions.append(functionName)</span><br><span class="line">    fp.write(functionName)</span><br><span class="line">    print(functionName)</span><br><span class="line">fp.close()</span><br><span class="line"></span><br><span class="line">idc.Exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p><em>其中<code>idc.Wait()</code>表示带有<code>-A</code>参数时，等待 ida 自动分析过程完成后再运行后续脚本，<code>idc.Exit(0)</code>表示脚本运行结束后自动关闭 ida</em></p>
<p>不过在实际测试时，<code>idaq -c -A -Stest.py heap_test</code>失败且没有任何错误提示，参阅了<a href="http://researchcenter.paloaltonetworks.com/2016/06/unit42-using-idapython-to-make-your-life-easier-part-6/" target="_blank" rel="external">Using IDAPython to Make Your Life Easier: Part 6
</a><sup>3</sup>，脚本和命令都没什么问题，不知是不是因为 Demo 版的缘故。。。</p>
<p><code>idaq -c -Stest.py heap_test</code>倒是一切正常，只好暂且如此了。。。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="http://blog.csdn.net/zhangmiaoping23/article/details/14521995" target="_blank" rel="external">http://blog.csdn.net/zhangmiaoping23/article/details/14521995</a></li>
<li><a href="http://www.h4ck.org.cn/2012/03/ida-batch-mode/" target="_blank" rel="external">http://www.h4ck.org.cn/2012/03/ida-batch-mode/</a></li>
<li><a href="http://researchcenter.paloaltonetworks.com/2016/06/unit42-using-idapython-to-make-your-life-easier-part-6/" target="_blank" rel="external">http://researchcenter.paloaltonetworks.com/2016/06/unit42-using-idapython-to-make-your-life-easier-part-6/</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/12/redis-brew/" itemprop="url">
                  Mac 下使用 homebrew 安装 redis
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-12T11:44:37+08:00" content="2016-09-12">
              2016-09-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/12/redis-brew/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/12/redis-brew/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">$ brew install redis</span><br><span class="line">=<span class="function">=&gt;</span> Downloading https:<span class="regexp">//</span>homebrew.bintray.com/bottles/redis<span class="number">-3.2</span><span class="number">.3</span>.el_capitan.bottle.tar.gz</span><br><span class="line"><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span><span class="comment">######</span> <span class="number">100.0</span>%</span><br><span class="line">=<span class="function">=&gt;</span> Pouring redis<span class="number">-3.2</span><span class="number">.3</span>.el_capitan.bottle.tar.gz</span><br><span class="line">=<span class="function">=&gt;</span> Caveats</span><br><span class="line">To have launchd start redis now <span class="keyword">and</span> restart at login:</span><br><span class="line">  brew services start redis</span><br><span class="line">Or, <span class="keyword">if</span> you don<span class="string">'t want/need a background service you can just run:</span><br><span class="line">  redis-server /usr/local/etc/redis.conf</span><br><span class="line">==&gt; Summary</span><br><span class="line">🍺  /usr/local/Cellar/redis/3.2.3: 10 files, 1.7M</span></span><br></pre></td></tr></table></figure>
<p>这样就安装好了，很是方便<br>不过暂时有一个问题：每次都要手动打开<code>redis-server</code>后才能<code>redis-cli</code>，否则提示<code>not connected</code>   </p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">$ redis-cli</span><br><span class="line">Could <span class="keyword">not</span> connect <span class="keyword">to</span> Redis <span class="keyword">at</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>: Connection refused</span><br><span class="line">Could <span class="keyword">not</span> connect <span class="keyword">to</span> Redis <span class="keyword">at</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>: Connection refused</span><br><span class="line"><span class="keyword">not</span> connected&gt;</span><br></pre></td></tr></table></figure>
<p>其实<code>brew</code>很贴心，之前安装完已经提醒过可以<code>brew services start redis</code>来自动启动，另外还可以使用<code>brew info</code>来看看提示信息</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">$ brew info redis</span><br><span class="line">redis: stable 3.2.3 (bottled), HEAD</span><br><span class="line">Persistent key-value database, with built-in net interface</span><br><span class="line">http://redis.io/</span><br><span class="line"><span class="comment">/usr/local/Cellar/redis/3.2.3 (10 files, 1.7M) *</span></span><br><span class="line">  Poured from bottle on 2016-09-18 at 09:51:13</span><br><span class="line">From: https://github.com/Homebrew/homebrew-core/blob/master/Formula/redis.rb</span><br><span class="line">=<span class="ruby">=&gt; Options</span><br><span class="line"></span>-<span class="ruby">-with-jemalloc</span><br><span class="line"></span>	Select jemalloc as memory allocator when building Redis</span><br><span class="line">-<span class="ruby">-HEAD</span><br><span class="line"></span>	Install HEAD version</span><br><span class="line">=<span class="ruby">=&gt; Caveats</span><br><span class="line"></span>To have launchd start redis now and restart at login:</span><br><span class="line">  brew services start redis</span><br><span class="line">Or, if you don't want/need a background service you can just run:</span><br><span class="line">  redis-server /usr/local/etc/redis.conf</span><br><span class="line">$ brew services start redis</span><br><span class="line">=<span class="ruby">=&gt; Tapping homebrew/services</span><br><span class="line"></span>Cloning into '/usr/local/Library/Taps/homebrew/homebrew-services'...</span><br><span class="line">remote: Counting objects: 7, done.</span><br><span class="line">remote: Compressing objects: 100% (6/6), done.</span><br><span class="line">remote: Total 7 (delta 0), reused 3 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (7/7), done.</span><br><span class="line">Checking connectivity... done.</span><br><span class="line">Tapped 0 formulae (32 files, 46.3K)</span><br><span class="line">=<span class="ruby">=&gt; Successfully started <span class="string">`redis`</span> (<span class="symbol">label:</span> homebrew.mxcl.redis)</span><br><span class="line"></span>$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>这样就可以了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/23/Q判断Gadget时遇到align伪指令的问题/" itemprop="url">
                  Q 判断 Gadget 时遇到 align 伪指令的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-23T13:13:57+08:00" content="2016-08-23">
              2016-08-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Q/" itemprop="url" rel="index">
                    <span itemprop="name">Q</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/23/Q判断Gadget时遇到align伪指令的问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/23/Q判断Gadget时遇到align伪指令的问题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天在利用 Q 判断 Gadget 时发现，在 IDA 中静态分析时显示如下的指令片段：</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="meta">align</span> <span class="number">10h</span></span><br><span class="line"><span class="keyword">ret</span></span><br></pre></td></tr></table></figure>
<p>会被判断为 Gadget，并且还莫名其妙扯上了 esi</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">8d7600c3</span><br><span class="line">MoveReg(Address: <span class="number">0x40000</span>, Complexity <span class="number">0.67</span>, Stack <span class="number">0x4</span>, <span class="built_in">Ip</span> <span class="number">0x0</span>, Output: <span class="built_in">esi</span>, Inputs [<span class="built_in">esi</span>])</span><br><span class="line">AndGadget(Address: <span class="number">0x40000</span>, Complexity <span class="number">0.67</span>, Stack <span class="number">0x4</span>, <span class="built_in">Ip</span> <span class="number">0x0</span>, Output: <span class="built_in">esi</span>, Inputs [<span class="built_in">esi</span>, <span class="built_in">esi</span>])</span><br><span class="line">OrGadget(Address: <span class="number">0x40000</span>, Complexity <span class="number">0.67</span>, Stack <span class="number">0x4</span>, <span class="built_in">Ip</span> <span class="number">0x0</span>, Output: <span class="built_in">esi</span>, Inputs [<span class="built_in">esi</span>, <span class="built_in">esi</span>])</span><br></pre></td></tr></table></figure>
<p>实在百思不得其解   </p>
<p>按理说<code>伪指令</code>并没有实际的机器码与之对应，但是<code>ret</code>对应<code>c3</code>，那么只能解释为<code>align 10h</code>对应<code>8d7600</code>了</p>
<p>好在 Google 到了<a href="http://www.codingnow.com/2000/frame.htm?http://www.codingnow.com/2000/essay/align.htm" target="_blank" rel="external">一篇文章</a>，提到了汇编器处理<code>align</code>伪指令的原理</p>
<blockquote>
<p>我原来以为, VC 将插入 NOP 来对齐代码, 结果发现, 为了提高效率, VC 按情况填入了单字节,双字节, 三字节指令做空操作, 使空操作的时间最短. 当需要插入 1 字节时, 理所当然的插入一个 0x90 (NOP); 需要插入 2 字节时则是 0x8b 0xff (MOV DI,DI) 这也无可厚非, 此指令不破坏任何寄存器, 也不影响标志位; 可需要填入 3 个字节的时候, 我用的 VC6 却令人费解的填入了 0x8d 0x49 0x00 (LEA CX,[BX+DI+00]), 很明显它影响了 CX, 而风魂的代码就是受到了它的影响.</p>
</blockquote>
<p>我这才恍然大悟，拿 capstone 反汇编了一下<code>8d7600</code>得到</p>
<figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">lea</span>	<span class="built_in">esi</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">esi</span>]</span><br></pre></td></tr></table></figure>
<p>果然，汇编器在处理<code>align</code>时，插入了这样一个<code>不破坏任何寄存器也不影响标志位</code>的指令来实现对齐效果</p>
<p>而 Q（使用 capstone 反汇编）接收到传入的指令时，自然会按照实际的机器指令而不是<code>align 10h</code>来进行 Gadget 判断，所以出现了上面的结果</p>
<p>大致如此…</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/16/Flask-relationship-backref/" itemprop="url">
                  Flask-SQLAlchemy 中的 relationship & backref
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-08-16T14:29:07+08:00" content="2016-08-16">
              2016-08-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Flask/" itemprop="url" rel="index">
                    <span itemprop="name">Flask</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/16/Flask-relationship-backref/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/16/Flask-relationship-backref/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天重看 Flask 时，发现对<code>backref</code>仍然没有理解透彻。查阅<a href="http://flask-sqlalchemy.pocoo.org/2.1/models/" target="_blank" rel="external">文档</a>后发现，以前试图孤立地理解<code>backref</code>是问题之源，<code>backref</code>是与<code>relationship</code>配合使用的。</p>
<h1 id="一对多关系"><a href="#一对多关系" class="headerlink" title="一对多关系"></a>一对多关系</h1><p><code>db.relationship()</code>用于在两个表之间建立<code>一对多关系</code>。例如书中 roles 表中一个 User 角色，可以对应 users 表中多个实际的普通用户。实现这种关系时，要在“多”这一侧加入一个外键，指向“一”这一侧联接的记录。</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">	<span class="comment"># ...</span></span><br><span class="line">	users = db.relationship(<span class="string">'User'</span>, backref=<span class="string">'role'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">	<span class="comment"># ...</span></span><br><span class="line">	role_id = db.Column(db.Integer, db.ForeignKey(<span class="string">'roles.id'</span>))</span><br></pre></td></tr></table></figure>
<h2 id="relationship-amp-ForeighKey"><a href="#relationship-amp-ForeighKey" class="headerlink" title="relationship &amp; ForeighKey"></a>relationship &amp; ForeighKey</h2><p>大多数情况下, db.relationship() 都能自行找到关系中的外键, 但有时却无法决定把 哪一列作为外键。 例如, 如果 User 模型中有两个或以上的列定义为 Role 模型的外键, SQLAlchemy 就不知道该使用哪列。如果无法决定外键,你就要为 db.relationship() 提供额外参数,从而确定所用外键。（见书 P49）</p>
<h2 id="relationship-amp-backref"><a href="#relationship-amp-backref" class="headerlink" title="relationship &amp; backref"></a>relationship &amp; backref</h2><p>通过<code>db.relationship()</code>，Role 模型有了一个可以获得对应角色所有用户的属性<code>users</code>。默认是列表形式，<code>lazy=&#39;dynamic&#39;</code>时返回的是一个 query 对象。即<code>relationship</code>提供了 Role 对 User 的访问。</p>
<p>而<code>backref</code>正好相反，提供了 User 对 Role 的访问。</p>
<p>不妨设一个 Role 实例为 <code>user_role</code>，一个 User 实例为 <code>u</code>。relationship 使 <code>user_role.users</code> 可以访问所有符合角色的用户，而 backref 使 <code>u.role</code> 可以获得用户对应的角色。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">$ p manage.py shell</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>user_role = Role.query.filter_by(name=<span class="string">'User'</span>).all()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>user_role</span><br><span class="line">[&lt;Role <span class="string">u'User'</span>&gt;]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>user_role = Role.query.filter_by(name=<span class="string">'User'</span>).first()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>user_role</span><br><span class="line">&lt;Role <span class="string">u'User'</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>user_role.users</span><br><span class="line">&lt;sqlalchemy.orm.dynamic.AppenderBaseQuery object at <span class="number">0x1087c1050</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>user_role.users.order_by(User.username).all()</span><br><span class="line">[&lt;User <span class="string">u'alice78'</span>&gt;, &lt;User <span class="string">u'andrea86'</span>&gt;, &lt;User <span class="string">u'hmr'</span>&gt;]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Role.query.all()</span><br><span class="line">[&lt;Role <span class="string">u'Moderator'</span>&gt;, &lt;Role <span class="string">u'Administrator'</span>&gt;, &lt;Role <span class="string">u'User'</span>&gt;]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>user_role.users.count()</span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u = User.query.filter_by(username=<span class="string">'hmr'</span>).first()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u</span><br><span class="line">&lt;User <span class="string">u'hmr'</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>u.role</span><br><span class="line">&lt;Role <span class="string">u'User'</span>&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h1 id="一对一关系"><a href="#一对一关系" class="headerlink" title="一对一关系"></a>一对一关系</h1><p>除了一对多之外, 还有几种其他的关系类型。一对一关系可以用前面介绍的一对多关系表示, 但调用 db.relationship() 时要把 uselist 设为 False , 把“多”变成“一”。 </p>
<h1 id="多对多关系"><a href="#多对多关系" class="headerlink" title="多对多关系"></a>多对多关系</h1><p><code>多对多关系</code>在书 P131 讲得很清楚。</p>
<p>在 P134 的实际例子中，使用两个一对多关系实现多对多关系。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/28/hexo-rss-sitemap/" itemprop="url">
                  hexo-rss-sitemap
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-07-28T10:42:46+08:00" content="2016-07-28">
              2016-07-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/hexo/" itemprop="url" rel="index">
                    <span itemprop="name">hexo</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/28/hexo-rss-sitemap/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/28/hexo-rss-sitemap/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天突然发现没给博客添加<code>RSS</code>订阅和<code>sitemap</code>（站点地图，方便搜索引擎的收录）<br>尝试了一下发觉还挺方便的   </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span> hexo-generator-feed <span class="comment">--save</span></span><br><span class="line">npm <span class="keyword">install</span> hexo-generator-baidu-sitemap <span class="comment">--save</span></span><br></pre></td></tr></table></figure>
<p>这里一定要加上<code>--save</code>，否则无法<code>generate</code>对应的 xml</p>
<p>然后在根目录的<code>_config.xml</code>加入</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"># RSS &amp; sitemap</span><br><span class="line"># Extensions</span><br><span class="line">Plugins:</span><br><span class="line">- hexo-generator-feed</span><br><span class="line">- hexo-generator-sitemap</span><br><span class="line"></span><br><span class="line"># Feed Atom</span><br><span class="line">feed:</span><br><span class="line">  type: atom</span><br><span class="line">  path: atom.xml</span><br><span class="line">  limit: 20</span><br><span class="line"></span><br><span class="line"># sitemap</span><br><span class="line">sitemap:</span><br><span class="line">  path: sitemap.xml</span><br></pre></td></tr></table></figure>
<p>然后<code>hexo g</code>即可生成对应 xml</p>
<blockquote>
<p>INFO  Start processing<br>INFO  Files loaded in 650 ms<br>INFO  Generated: atom.xml<br>INFO  Generated: sitemap.xml<br>INFO  2 files generated in 2.47 s</p>
</blockquote>
<p>这时访问对应路径即可验证，另外边栏也可以看见<code>RSS</code>图标了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/25/Python闭包/" itemprop="url">
                  Python 中的闭包与装饰器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-07-25T10:18:09+08:00" content="2016-07-25">
              2016-07-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/25/Python闭包/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/25/Python闭包/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Closure-闭包"><a href="#Closure-闭包" class="headerlink" title="Closure(闭包)"></a>Closure(闭包)</h1><p>什么是闭包?简单说,闭包就是根据不同的配置信息得到不同的结果。</p>
<p>专业的解释:闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。所以，有另一种说法认为闭包是由函数和与其相关的引用环境组合而成的实体。</p>
<p>概念总是有点抽象，下面结合示例说下我自己的理解。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>外部函数包裹内部函数</li>
<li>外部函数最终返回一个函数对象，即一个内部函数实例</li>
<li>外部函数传入的参数不同时，会返回不同的内部函数实例</li>
<li>外部函数用于<code>绑定</code>，内部函数用于<code>处理</code></li>
<li>外部函数绑定的参数为<code>函数</code>时，即为<code>装饰器</code></li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plus</span><span class="params">(augend)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'augend:'</span>, augend</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">plus_inside</span><span class="params">(addend)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'addend:'</span>, addend</span><br><span class="line">        result = augend + addend</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'result:'</span>, result</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> plus_inside</span><br><span class="line"></span><br><span class="line">p20 = plus(<span class="number">20</span>)</span><br><span class="line"><span class="comment"># -&gt; augend: 20</span></span><br><span class="line"><span class="comment"># 只打印 augend 说明内部处理函数尚未执行</span></span><br><span class="line"><span class="comment"># 只是完成了将 augend 与处理函数绑定的操作</span></span><br><span class="line"></span><br><span class="line">p20(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># -&gt; addend: 1</span></span><br><span class="line"><span class="comment"># -&gt; result: 21</span></span><br></pre></td></tr></table></figure>
<h1 id="Decorator-装饰器"><a href="#Decorator-装饰器" class="headerlink" title="Decorator(装饰器)"></a>Decorator(装饰器)</h1><p>前面已经提到，装饰器本质就是外部函数绑定参数为函数的闭包。</p>
<p>另外 Python 给它添加了一个更优雅的调用方式，用在被绑定函数<code>f</code>之前添加<code>@wrapper</code>的方式，代替在被绑定函数<code>f</code>定义后使用<code>f = wrapper(f)</code>手动赋值的方式，来进行绑定。</p>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makebold</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;b&gt;"</span> + fn() + <span class="string">"&lt;/b&gt;"</span></span><br><span class="line">    <span class="keyword">return</span> wrapped</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeitalic</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapped</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;i&gt;"</span> + fn() + <span class="string">"&lt;/i&gt;"</span></span><br><span class="line">    <span class="keyword">return</span> wrapped</span><br><span class="line"></span><br><span class="line"><span class="meta">@makebold</span></span><br><span class="line"><span class="meta">@makeitalic</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello world"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> hello() </span><br><span class="line"><span class="comment"># -&gt; &lt;b&gt;&lt;i&gt;hello world&lt;/i&gt;&lt;/b&gt;</span></span><br><span class="line"><span class="comment"># 注意&lt;b&gt;和&lt;i&gt;的顺序</span></span><br></pre></td></tr></table></figure>
<h2 id="保持函数默认参数常新的装饰器"><a href="#保持函数默认参数常新的装饰器" class="headerlink" title="保持函数默认参数常新的装饰器"></a>保持函数默认参数常新的装饰器</h2><p>Cookbook 20.1 里有个特别的例子。</p>
<p>Python 里函数的默认参数只在函数定义时求值一次，然后存入函数内建的 func_defaults 元组内。如果是不可变参数（如 1、’qwe’、None 等），完全没有问题；但如果是类似列表这样的可变参数，重新调用函数时默认的列表可能已经面目全非。</p>
<p>书中提供了两种解决该问题的方法：</p>
<h3 id="标准方法"><a href="#标准方法" class="headerlink" title="标准方法"></a>标准方法</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packitem</span><span class="params">(item, pkg=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> pkg <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        pkg = []</span><br><span class="line">    pkg.append(item)</span><br><span class="line">    <span class="keyword">return</span> pkg</span><br></pre></td></tr></table></figure>
<h3 id="装饰器方法"><a href="#装饰器方法" class="headerlink" title="装饰器方法"></a>装饰器方法</h3><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">freshdefaults</span><span class="params">(f)</span>:</span></span><br><span class="line">    <span class="string">"a decorator to wrap f and keep its default values fresh between calls"</span></span><br><span class="line">    fdefaults = f.func_defaults</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">refresher</span><span class="params">(*args, **kwds)</span>:</span></span><br><span class="line">        f.func_defaults = deepcopy(fdefaults)</span><br><span class="line">        <span class="keyword">return</span> f(*args, **kwds)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 用于在 print 时区别不同的被绑定函数，2.4 后有效，见 Cookbook 20.1 </span></span><br><span class="line">    refresher.__name__ = f.__name__</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> refresher</span><br><span class="line"></span><br><span class="line"><span class="comment"># usage as a decorator, in python 2.4:</span></span><br><span class="line"><span class="meta">@freshdefaults</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">packitem</span><span class="params">(item, pkg=[])</span>:</span></span><br><span class="line">    pkg.append(item)</span><br><span class="line">    <span class="keyword">return</span> pkg</span><br><span class="line"><span class="comment"># usage in python 2.3: after the function definition, explicitly assign:</span></span><br><span class="line"><span class="comment"># f = freshdefaults(f)</span></span><br></pre></td></tr></table></figure>
<h3 id="Ref"><a href="#Ref" class="headerlink" title="Ref."></a>Ref.</h3><ul>
<li><a href="http://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html" target="_blank" rel="external">http://www.cnblogs.com/ma6174/archive/2013/04/15/3022548.html</a></li>
<li>Cookbook 20.1</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Air9" />
          <p class="site-author-name" itemprop="name">Air9</p>
          <p class="site-description motion-element" itemprop="description">なぜベストを尽くしたのか</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">38</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>
          
          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">75</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Air9</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"answerrrrrrrrr"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  


</body>
</html>
